# è¿è¡Œå•å…ƒæµ‹è¯•æŒ‡å—

## âœ… å·²å®Œæˆçš„å•å…ƒæµ‹è¯•

æœ¬æ¬¡ç¬¬13å‘¨æµ‹è¯•å·¥ä½œå·²å®Œæˆä»¥ä¸‹æ ¸å¿ƒæ¨¡å—çš„å•å…ƒæµ‹è¯•ï¼š

### 1. å»é‡é€»è¾‘æµ‹è¯•ï¼ˆdedup_service_test.goï¼‰
- âœ… å½“å‰åˆ†ç»„å»é‡æµ‹è¯•ï¼ˆæ— é‡å¤ã€æœ‰é‡å¤ã€ä¸åŒåˆ†ç»„ï¼‰
- âœ… å…¨å±€å»é‡æµ‹è¯•ï¼ˆæ— é‡å¤ã€æœ‰é‡å¤ã€è·¨åˆ†ç»„ï¼‰
- âœ… åº•åº“å»é‡æµ‹è¯•ï¼ˆæ— é‡å¤ã€æœ‰é‡å¤ã€ä¸åŒå¹³å°ã€å·²åˆ é™¤è®°å½•ï¼‰
- âœ… å¤šç§å»é‡æ¨¡å¼æµ‹è¯•ï¼ˆcurrent/globalï¼‰
- âœ… å¤šæ¡ç›¸åŒè®°å½•æµ‹è¯•

### 2. ç»Ÿè®¡è®¡ç®—æµ‹è¯•ï¼ˆstats_service_test.goï¼‰
- âœ… åˆ†ç»„ç»Ÿè®¡è·å–æµ‹è¯•ï¼ˆå­˜åœ¨/ä¸å­˜åœ¨è‡ªåŠ¨åˆ›å»ºï¼‰
- âœ… è´¦å·ç»Ÿè®¡è·å–æµ‹è¯•ï¼ˆå­˜åœ¨/ä¸å­˜åœ¨è‡ªåŠ¨åˆ›å»ºï¼‰
- âœ… æ€»è§ˆç»Ÿè®¡æµ‹è¯•ï¼ˆåŒ…å«ç©ºæ•°æ®æƒ…å†µï¼‰
- âœ… è¿›çº¿è¶‹åŠ¿è®¡ç®—æµ‹è¯•ï¼ˆ7/15/30å¤©ï¼‰
- âœ… å¤šæ—¥æœŸæ•°æ®æµ‹è¯•

### 3. è¿›çº¿å¤„ç†æµ‹è¯•ï¼ˆincoming_service_test.goï¼‰
- âœ… è¿›çº¿æ•°æ®å¤„ç†æµ‹è¯•ï¼ˆæ— é‡å¤ã€æœ‰é‡å¤ï¼‰
- âœ… å»é‡æ¨¡å¼æµ‹è¯•ï¼ˆcurrent/globalï¼‰
- âœ… ç»Ÿè®¡æ›´æ–°æµ‹è¯•ï¼ˆè´¦å·ç»Ÿè®¡ã€åˆ†ç»„ç»Ÿè®¡ï¼‰
- âœ… åº•åº“æ·»åŠ æµ‹è¯•ï¼ˆä¸é‡å¤æ—¶æ·»åŠ ï¼‰
- âœ… å¤šè´¦å·è¿›çº¿æµ‹è¯•
- âœ… å®Œæ•´å­—æ®µæµ‹è¯•
- âœ… äº‹åŠ¡å›æ»šæµ‹è¯•

## ğŸ“ æµ‹è¯•è¦†ç›–è¯´æ˜

æœ¬æ¬¡å•å…ƒæµ‹è¯•è¦†ç›–äº†ç³»ç»Ÿæœ€æ ¸å¿ƒçš„ä¸‰ä¸ªåŠŸèƒ½æ¨¡å—ï¼š
1. **å»é‡é€»è¾‘** - ç³»ç»Ÿçš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œç¡®ä¿è¿›çº¿æ•°æ®æ­£ç¡®å»é‡
2. **ç»Ÿè®¡è®¡ç®—** - ç¡®ä¿å„ç±»ç»Ÿè®¡æ•°æ®å‡†ç¡®è®¡ç®—å’Œæ±‡æ€»
3. **è¿›çº¿å¤„ç†** - å®Œæ•´çš„è¿›çº¿æ•°æ®å¤„ç†æµç¨‹ï¼ŒåŒ…æ‹¬å»é‡ã€ç»Ÿè®¡ã€åº•åº“ç®¡ç†

è¿™ä¸‰ä¸ªæ¨¡å—æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå•å…ƒæµ‹è¯•é€šè¿‡åå¯ä»¥ç¡®ä¿ç³»ç»Ÿçš„ä¸»è¦ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§ã€‚

## ğŸ”§ è¿è¡Œæµ‹è¯•å‰çš„å‡†å¤‡

### 1. åˆ›å»ºæµ‹è¯•æ•°æ®åº“

```sql
-- ä½¿ç”¨PostgreSQLå‘½ä»¤è¡Œæˆ–GUIå·¥å…·æ‰§è¡Œ
CREATE DATABASE line_management_test;
```

### 2. åˆå§‹åŒ–æµ‹è¯•æ•°æ®åº“è¡¨ç»“æ„

```powershell
# åœ¨backendç›®å½•ä¸‹æ‰§è¡Œ
$env:PGPASSWORD="your_password"
psql -U postgres -d line_management_test -f migrations/001_init_schema.sql
```

æˆ–è€…ä½¿ç”¨ä½ çš„æ•°æ®åº“å¯†ç ï¼š
```powershell
psql -U postgres -d line_management_test -f migrations/001_init_schema.sql
# ç„¶åè¾“å…¥å¯†ç 
```

### 3. é…ç½®æµ‹è¯•æ•°æ®åº“è¿æ¥

æµ‹è¯•ä½¿ç”¨çš„æ•°æ®åº“é…ç½®åœ¨ `helper.go` ä¸­ï¼š
- Host: localhost
- Port: 5432
- User: postgres
- Password: 123456
- DBName: line_management_test

å¦‚æœä½ çš„æ•°æ®åº“é…ç½®ä¸åŒï¼Œè¯·ä¿®æ”¹ `helper.go` ä¸­çš„é…ç½®ã€‚

## ğŸš€ è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•

```powershell
cd backend
go test ./tests/unit/... -v
```

### è¿è¡Œç‰¹å®šæµ‹è¯•å¥—ä»¶

```powershell
# è¿è¡Œå»é‡é€»è¾‘æµ‹è¯•
go test ./tests/unit/... -v -run TestDedupServiceTestSuite

# è¿è¡Œç»Ÿè®¡è®¡ç®—æµ‹è¯•
go test ./tests/unit/... -v -run TestStatsServiceTestSuite

# è¿è¡Œè¿›çº¿å¤„ç†æµ‹è¯•
go test ./tests/unit/... -v -run TestIncomingServiceTestSuite
```

### è¿è¡Œç‰¹å®šæµ‹è¯•ç”¨ä¾‹

```powershell
# è¿è¡Œå»é‡é€»è¾‘ä¸­çš„æŸä¸ªå…·ä½“æµ‹è¯•
go test ./tests/unit/... -v -run TestDedupServiceTestSuite/TestCheckDuplicateCurrent_NoDuplicate
```

### æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡

```powershell
go test ./tests/unit/... -cover
go test ./tests/unit/... -coverprofile=coverage.out
go tool cover -html=coverage.out
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æµ‹è¯•æ•°æ®åº“ç‹¬ç«‹**: æµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„ `line_management_test` æ•°æ®åº“ï¼Œä¸ä¼šå½±å“ç”Ÿäº§æ•°æ®
2. **è‡ªåŠ¨æ¸…ç†**: æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå‰éƒ½ä¼šè‡ªåŠ¨æ¸…ç†æµ‹è¯•æ•°æ®
3. **æµ‹è¯•éš”ç¦»**: æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œäº’ä¸å½±å“
4. **æ•°æ®åº“è¿æ¥**: ç¡®ä¿PostgreSQLæœåŠ¡æ­£åœ¨è¿è¡Œ
5. **è¡¨ç»“æ„åˆå§‹åŒ–**: é¦–æ¬¡è¿è¡Œæµ‹è¯•å‰å¿…é¡»å…ˆåˆå§‹åŒ–è¡¨ç»“æ„

## ğŸ¯ æµ‹è¯•ç»“æœè¯´æ˜

æµ‹è¯•é€šè¿‡åä¼šæ˜¾ç¤ºç±»ä¼¼å¦‚ä¸‹è¾“å‡ºï¼š

```
=== RUN   TestDedupServiceTestSuite
=== RUN   TestDedupServiceTestSuite/TestCheckDuplicateCurrent_NoDuplicate
=== RUN   TestDedupServiceTestSuite/TestCheckDuplicateCurrent_Duplicate
...
--- PASS: TestDedupServiceTestSuite (0.50s)
    --- PASS: TestDedupServiceTestSuite/TestCheckDuplicateCurrent_NoDuplicate (0.05s)
    --- PASS: TestDedupServiceTestSuite/TestCheckDuplicateCurrent_Duplicate (0.05s)
    ...
PASS
ok      line-management/tests/unit      2.500s
```

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

- æ€»æµ‹è¯•å¥—ä»¶æ•°: 3ä¸ª
- æ€»æµ‹è¯•ç”¨ä¾‹æ•°: 30+ä¸ª
- æµ‹è¯•æ–‡ä»¶: 
  - dedup_service_test.go (14ä¸ªæµ‹è¯•ç”¨ä¾‹)
  - stats_service_test.go (11ä¸ªæµ‹è¯•ç”¨ä¾‹)
  - incoming_service_test.go (9ä¸ªæµ‹è¯•ç”¨ä¾‹)

## ğŸ”„ ä¸‹ä¸€æ­¥

å¦‚æœæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œè¯´æ˜ç³»ç»Ÿæ ¸å¿ƒåŠŸèƒ½è¿è¡Œæ­£å¸¸ï¼Œå¯ä»¥ç»§ç»­ï¼š
1. è¿›è¡ŒAPIé›†æˆæµ‹è¯•
2. è¿›è¡ŒWebSocketæ€§èƒ½æµ‹è¯•
3. è¿›è¡Œæ•°æ®åº“æ€§èƒ½æµ‹è¯•

## ğŸ› å¸¸è§é—®é¢˜

### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯**: `connection to server at "localhost" failed`

**è§£å†³**: 
- æ£€æŸ¥PostgreSQLæœåŠ¡æ˜¯å¦å¯åŠ¨
- æ£€æŸ¥æ•°æ®åº“é…ç½®æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 2. è¡¨ä¸å­˜åœ¨

**é”™è¯¯**: `relation "xxx" does not exist`

**è§£å†³**: 
- ç¡®ä¿å·²æ‰§è¡Œæ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
- æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„æµ‹è¯•æ•°æ®åº“

### 3. ç¼–è¯‘é”™è¯¯

**é”™è¯¯**: æµ‹è¯•æ–‡ä»¶ç¼–è¯‘å¤±è´¥

**è§£å†³**:
```powershell
go mod tidy
go test -c ./tests/unit/...
```

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•è¾…åŠ©å·¥å…·è¯´æ˜](./helper.go) - æµ‹è¯•æ•°æ®åˆ›å»ºå’Œæ¸…ç†
- [é¡¹ç›®å®æ–½è§„åˆ’](../../é¡¹ç›®å®æ–½è§„åˆ’.md) - æŸ¥çœ‹ç¬¬13å‘¨æµ‹è¯•è®¡åˆ’
- [æ•°æ®åº“è¡¨è®¾è®¡](../../æ•°æ®åº“è¡¨è®¾è®¡-å®Œæ•´ç‰ˆ.md) - äº†è§£è¡¨ç»“æ„

---

**æµ‹è¯•å®Œæˆæ—¥æœŸ**: 2025-12-23
**æµ‹è¯•ç‰ˆæœ¬**: v1.0
**æµ‹è¯•çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•å®Œæˆ

