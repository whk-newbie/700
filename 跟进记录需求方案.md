# 跟进记录管理 - 需求方案

> **版本**: v1.0
> **更新日期**: 2025-12-21
> **说明**: 基于CEO SCRM系统跟进记录页面设计，所有功能保留

---

## 📋 页面概述

### 核心功能
跟进记录用于记录和管理当前账号所有激活码下线索的跟进同步记录。

### 页面路径
`/follow-up-records`

### 页面说明
当前账号所有激活码下线索跟进同步记录

---

## 🔍 筛选功能

### 筛选条件

#### 1. 时间范围筛选
- **字段**: `created_at`
- **类型**: 日期范围选择器
- **显示**: 
  ```
  [开始时间] ~ [截止时间]
  ```

#### 2. APP选择（平台）
- **字段**: `platform_type`
- **类型**: 下拉选择
- **选项**:
  - 全部APP
  - Line
  - Line Business

**显示**:
```
[请选择APP ▼]
```

#### 3. 激活码筛选
- **字段**: `activation_code`
- **类型**: 下拉选择 + 文本输入框组合
- **下拉选项**: 
  - 激活码
  - 其他字段（可选）
- **输入框**: 模糊搜索

**显示**:
```
[激活码 ▼]  [请输入         ]
```

### 筛选操作按钮
```
[🔍 搜索]  [🔄 重选]
```

- **搜索**: 应用筛选条件
- **重选**: 清空所有筛选条件，恢复默认状态

---

## 📊 列表字段定义

### 所有字段（保留全部）

| 序号 | 字段名 | 说明 |
|-----|--------|------|
| 1 | ☑ | 复选框 |
| 2 | 激活码 | 所属激活码 |
| 3 | 主账号信息 | Line主账号的头像和显示名称 |
| 4 | 主账号 | Line主账号的ID |
| 5 | 线索账号信息 | 线索（客户）的头像和显示名称 |
| 6 | 线索账号 | 线索（客户）的Line User ID |
| 7 | 创建日期 | 跟进记录创建时间 |
| 8 | 内容 | 跟进记录的详细内容 |
| 9 | 操作 | 编辑、删除 |

---

## 📝 字段详细说明

### 1. 复选框
- **功能**: 勾选后可进行批量操作
- **位置**: 表格第一列

---

### 2. 激活码
- **字段名**: `activation_code`
- **类型**: `VARCHAR(32)`
- **说明**: 该跟进记录所属的激活码（分组）
- **显示方式**: 文字链接

**示例**:
```
qxK5JZHP
2nXZMRbA
zsXnJbgU
```

**交互**:
- 可点击跳转到该激活码的详情页

---

### 3. 主账号信息
- **字段名**: `line_account_display_name` + `line_account_id` + `avatar_url`
- **类型**: `VARCHAR(100)` + `VARCHAR(100)` + `VARCHAR(500)`
- **说明**: Line主账号的头像、显示名称和ID
- **显示方式**: 头像图片 + 两行文字

**示例**:
```
[头像] [平台图标]
ハルナ🌸☀️
salele9688
```

**显示结构**:
- 第一行：头像 + 平台图标
- 第二行：显示名称
- 第三行：Line ID

---

### 4. 主账号
- **字段名**: `line_account_line_id`
- **类型**: `VARCHAR(100)`
- **说明**: Line主账号的完整Line ID
- **显示方式**: 文字链接（可能较长）

**示例**:
```
Ylkzhm-HKNKEgRzs35ZR3pQ8jSxwZ2zKrFaqOEVtUykPjE7fRoLB81BrKwMobcz3
_99cWp4IekwAj3PDkFtojw5ur_oZIOUHo7wt2OyFMuk9eix6upWlpyh8bOM9xp1y
```

**交互**:
- 可点击查看账号详情

---

### 5. 线索账号信息
- **字段名**: `customer_display_name` + `customer_id` + `customer_avatar_url`
- **类型**: `VARCHAR(100)` + `VARCHAR(100)` + `VARCHAR(500)`
- **说明**: 线索（客户）的头像、显示名称和ID
- **显示方式**: 头像图片 + 两行文字

**示例**:
```
[头像] [平台图标]
マサテル 12/19高槻市73德华大象吉廣昌晃
rRVjczTi5roIwmiG9Jabc9IjZq3KeI6mtEMbEd4hZXLkiCAh2C2dw4-18TQRT_X6
```

**显示结构**:
- 第一行：头像 + 平台图标
- 第二行：显示名称（或备注）
- 第三行：Line ID

---

### 6. 线索账号
- **字段名**: `customer_line_id`
- **类型**: `VARCHAR(100)`
- **说明**: 线索（客户）的Line User ID
- **显示方式**: 文字链接

**示例**:
```
U16g1wNkGQvGHr24w_8XBkuiyZuLyiuRHWx0Jl6OA-gw
UVkAQz_yLy2UFsxCd83xnbD4gvDDQdED4LdSRZytRCS4
```

**交互**:
- 可点击查看客户详情

---

### 7. 创建日期
- **字段名**: `created_at`
- **类型**: `TIMESTAMP`
- **说明**: 该跟进记录创建的时间
- **显示方式**: 日期时间格式

**示例**:
```
2025-12-20 11:51:38
2025-12-20 11:54:13
2025-12-21 10:30:22
```

---

### 8. 内容
- **字段名**: `content`
- **类型**: `TEXT`
- **说明**: 跟进记录的详细内容
- **显示方式**: 文字显示

**示例**:
```
备注： マサテル 12/19高槻市73德华大象

昵称备注： 12.20 28 横浜市 阿阳 教授2 
客户标签：null

已联系客户，客户表示有兴趣，下周再次跟进
```

**内容格式**:
- 可包含多行文字
- 可包含备注信息
- 可包含客户标签信息
- 可包含自定义跟进内容

---

### 9. 操作
- **字段名**: -
- **类型**: 按钮组
- **说明**: 对该跟进记录的操作

**操作按钮**:
```
[✏️ 编辑] [🗑️ 删除]
```

**功能说明**:

#### 编辑
- **功能**: 编辑跟进记录的内容字段
- **触发**: 点击"编辑"按钮
- **交互**: 
  1. 弹出编辑对话框
  2. 显示当前内容
  3. 可修改内容
  4. 保存后更新记录

**编辑对话框**:
```
┌─────────────────────────────────────┐
│  编辑跟进记录              [关闭 ✕] │
├─────────────────────────────────────┤
│                                       │
│  内容：                               │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │                             │   │
│  │                             │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                       │
│         [保存]  [取消]               │
│                                       │
└─────────────────────────────────────┘
```

#### 删除
- **功能**: 删除该跟进记录
- **触发**: 点击"删除"按钮
- **交互**:
  1. 弹出确认对话框
  2. 确认："确定要删除这条跟进记录吗？"
  3. 确认后删除记录

---

## 📱 列表页面布局

### 页面结构
```
┌─────────────────────────────────────────────────────────────┐
│  📋 跟进记录                                                 │
│  说明：当前账号所有激活码下线索跟进同步记录                  │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  [筛选区域]                                                   │
│  ┌──────────┬────────────┬────────────┐                    │
│  │开始时间～│[请选择APP▼]│[激活码▼]   │                    │
│  │截止时间  │            │[请输入]    │                    │
│  └──────────┴────────────┴────────────┘                    │
│                                                               │
│  [🔍 搜索]  [🔄 重选]                                        │
│                                                               │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  [数据表格]                                                   │
│  ┌──┬────┬────────┬────────┬────────┬────────┬────┬────┬──┐│
│  │☑│激活│主账号  │主账号  │线索账号│线索账号│创建│内容│操││
│  │  │码  │信息    │        │信息    │        │日期│    │作││
│  ├──┼────┼────────┼────────┼────────┼────────┼────┼────┼──┤│
│  │☐│qxK │[头像]  │Ylkzhm-│[头像]  │U16g1w │12-2│备注│编││
│  │  │5JZ │ハルナ  │HKNKEg │マサテル│NkGQvG │0   │：  │辑││
│  │  │HP  │salele  │...    │12/19高 │...    │11: │マサ│删││
│  │  │    │9688    │       │槻...   │       │51  │テル│除││
│  │☐│qxK │[头像]  │_99cWp │[头像]  │UVkAQ │12-2│昵称│编││
│  │  │5JZ │ミレイ  │4IekwA │shu-ya  │z_yLy │0   │备注│辑││
│  │  │HP  │lov23   │...    │tJhD2o │...    │11: │：  │删││
│  │  │    │133     │       │...     │       │54  │12. │除││
│  └──┴────┴────────┴────────┴────────┴────────┴────┴────┴──┘│
│                                                               │
│  共 156 条   [10条/页 ▼]  [◀] [1][2][3]...[16] [▶]         │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

---

## 💾 数据库表结构

### follow_up_records 表（跟进记录表）

```sql
CREATE TABLE follow_up_records (
    id BIGSERIAL PRIMARY KEY,
    
    -- 关联信息
    group_id INTEGER NOT NULL REFERENCES groups(id) ON DELETE CASCADE,
    activation_code VARCHAR(32) NOT NULL,              -- 所属激活码
    line_account_id INTEGER REFERENCES line_accounts(id), -- Line主账号
    customer_id BIGINT REFERENCES customers(id),       -- 线索（客户）
    
    -- 平台信息
    platform_type VARCHAR(20) NOT NULL,                -- 'line' | 'line_business'
    
    -- 账号信息（冗余字段，方便查询）
    line_account_display_name VARCHAR(100),            -- 主账号显示名称
    line_account_line_id VARCHAR(100),                 -- 主账号Line ID
    line_account_avatar_url VARCHAR(500),              -- 主账号头像
    
    customer_display_name VARCHAR(100),                -- 线索显示名称
    customer_line_id VARCHAR(100),                     -- 线索Line User ID
    customer_avatar_url VARCHAR(500),                  -- 线索头像
    
    -- 跟进内容
    content TEXT NOT NULL,                             -- 跟进记录内容
    
    -- 创建者
    created_by INTEGER REFERENCES users(id),           -- 创建人
    
    -- 时间戳
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,    -- 创建时间
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,    -- 更新时间
    
    -- 索引
    INDEX idx_group_id (group_id),
    INDEX idx_activation_code (activation_code),
    INDEX idx_line_account (line_account_id),
    INDEX idx_customer (customer_id),
    INDEX idx_platform_type (platform_type),
    INDEX idx_created_at (created_at DESC)
);

-- 按月分区（性能优化）
CREATE TABLE follow_up_records_2025_01 PARTITION OF follow_up_records
    FOR VALUES FROM ('2025-01-01') TO ('2025-02-01');
```

---

## ➕ 新增跟进记录

### 新增方式

#### 方式1：从客户列表批量添加
- 在客户列表页面勾选客户
- 点击"跟进记录"按钮
- 弹出添加跟进记录对话框
- 填写跟进内容
- 保存后，该内容关联到所有选中的客户

#### 方式2：从跟进记录页面单独添加（可选）
- 点击"新增跟进记录"按钮
- 选择激活码、Line账号、客户
- 填写跟进内容
- 保存

### 新增对话框

```
┌─────────────────────────────────────┐
│  添加跟进记录              [关闭 ✕] │
├─────────────────────────────────────┤
│                                       │
│  已选客户：3个                        │
│                                       │
│  跟进内容：                           │
│  ┌─────────────────────────────┐   │
│  │ 请输入跟进内容...           │   │
│  │                             │   │
│  │                             │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                       │
│         [保存]  [取消]               │
│                                       │
└─────────────────────────────────────┘
```

---

## 🔄 数据同步

### 同步来源

#### 1. 手动添加
- 管理员或用户手动添加跟进记录
- 在客户列表或跟进记录页面添加

#### 2. 系统自动同步
- Windows客户端在社交账号上添加客户画像时
- 自动同步到服务器
- 创建跟进记录

### WebSocket消息格式

**跟进记录同步**:
```json
{
  "type": "follow_up_sync",
  "data": {
    "activation_code": "qxK5JZHP",
    "line_account_id": 123,
    "customer_id": 456,
    "content": "已联系客户，客户表示有兴趣",
    "platform_type": "line"
  }
}
```

---

## 🔘 批量操作（可选）

### 批量删除
- 勾选多条跟进记录
- 点击"批量删除"按钮
- 确认后删除选中的记录

---

## ✅ 已确认需求

- [x] 所有筛选功能（时间范围、APP、激活码）
- [x] 所有列表字段（9个字段）
- [x] 编辑功能（编辑内容字段）
- [x] 删除功能
- [x] 数据库表结构
- [x] 新增跟进记录功能
- [x] 数据同步机制
- [x] 页面布局设计


