# Dockeréƒ¨ç½² - RSAå¯†é’¥é…ç½®è¯´æ˜

## ğŸ” RSAå¯†é’¥ç®¡ç†

ç³»ç»Ÿä½¿ç”¨RSAéå¯¹ç§°åŠ å¯†æ¥ä¿æŠ¤OpenAI API Keyçš„ä¼ è¾“å®‰å…¨ã€‚åœ¨Dockerç¯å¢ƒä¸­ï¼ŒRSAå¯†é’¥ä¼šè‡ªåŠ¨ç”Ÿæˆå¹¶æŒä¹…åŒ–å­˜å‚¨ã€‚

## ğŸ“ å¯†é’¥å­˜å‚¨ä½ç½®

- **Dockerç¯å¢ƒ**: `/root/keys/` (æŒ‚è½½åˆ° `backend_keys` volume)
- **æœ¬åœ°å¼€å‘**: `./keys/` (é¡¹ç›®æ ¹ç›®å½•)

## ğŸ”§ é…ç½®è¯´æ˜

### 1. ç¯å¢ƒå˜é‡

åœ¨ `docker-compose.yml` ä¸­å·²é…ç½®ï¼š
```yaml
environment:
  RSA_KEYS_DIR: /root/keys  # RSAå¯†é’¥ç›®å½•
```

### 2. VolumeæŒ‚è½½

RSAå¯†é’¥ç›®å½•å·²æŒ‚è½½ä¸ºæŒä¹…åŒ–volumeï¼š
```yaml
volumes:
  - backend_keys:/root/keys  # RSAå¯†é’¥æŒä¹…åŒ–å­˜å‚¨
```

è¿™ç¡®ä¿å®¹å™¨é‡å¯åå¯†é’¥ä¸ä¼šä¸¢å¤±ã€‚

## ğŸš€ é¦–æ¬¡å¯åŠ¨

é¦–æ¬¡å¯åŠ¨æ—¶ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ï¼š
1. åˆ›å»º `/root/keys` ç›®å½•
2. ç”Ÿæˆ2048ä½RSAå¯†é’¥å¯¹
3. ä¿å­˜åˆ° `rsa_private.pem` å’Œ `rsa_public.pem`

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¯†é’¥å®‰å…¨**:
   - ç§é’¥æ–‡ä»¶æƒé™ä¸º `0600` (ä»…æ‰€æœ‰è€…å¯è¯»å†™)
   - å…¬é’¥æ–‡ä»¶æƒé™ä¸º `0644` (æ‰€æœ‰è€…å¯è¯»å†™ï¼Œå…¶ä»–ç”¨æˆ·åªè¯»)
   - ç§é’¥**ç»å¯¹ä¸èƒ½**æ³„éœ²æˆ–æäº¤åˆ°ä»£ç ä»“åº“

2. **å¯†é’¥æŒä¹…åŒ–**:
   - å¯†é’¥å­˜å‚¨åœ¨Docker volumeä¸­ï¼Œå®¹å™¨åˆ é™¤é‡å»ºä¸ä¼šä¸¢å¤±
   - å¦‚éœ€å¤‡ä»½ï¼Œå¯ä»¥å¯¼å‡ºvolumeæˆ–ç›´æ¥å¤‡ä»½å¯†é’¥æ–‡ä»¶

3. **å¯†é’¥è½®æ¢**:
   - å¦‚éœ€æ›´æ¢å¯†é’¥ï¼Œåˆ é™¤volumeä¸­çš„å¯†é’¥æ–‡ä»¶ï¼Œé‡å¯å®¹å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆæ–°å¯†é’¥
   - æ›´æ¢å¯†é’¥åï¼Œå‰ç«¯éœ€è¦é‡æ–°è·å–å…¬é’¥å¹¶åŠ å¯†API Key

## ğŸ” éªŒè¯å¯†é’¥

æ£€æŸ¥å¯†é’¥æ˜¯å¦å·²ç”Ÿæˆï¼š
```bash
# è¿›å…¥å®¹å™¨
docker exec -it line-mgmt-backend sh

# æŸ¥çœ‹å¯†é’¥æ–‡ä»¶
ls -la /root/keys/

# åº”è¯¥çœ‹åˆ°ï¼š
# rsa_private.pem (æƒé™ 600)
# rsa_public.pem (æƒé™ 644)
```

## ğŸ“ è¿ç§»å¯†é’¥

å¦‚æœéœ€è¦è¿ç§»å¯†é’¥åˆ°æ–°ç¯å¢ƒï¼š

```bash
# 1. å¯¼å‡ºå¯†é’¥
docker run --rm -v line-mgmt_backend_keys:/keys -v $(pwd):/backup alpine \
  tar czf /backup/rsa_keys_backup.tar.gz -C /keys .

# 2. åœ¨æ–°ç¯å¢ƒå¯¼å…¥
docker run --rm -v line-mgmt_backend_keys:/keys -v $(pwd):/backup alpine \
  tar xzf /backup/rsa_keys_backup.tar.gz -C /keys
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜ï¼šæ— æ³•ç”Ÿæˆå¯†é’¥

**åŸå› **: ç›®å½•æƒé™ä¸è¶³

**è§£å†³**:
```bash
# æ£€æŸ¥volumeæƒé™
docker volume inspect line-mgmt_backend_keys

# å¦‚æœéœ€è¦ï¼Œåˆ é™¤å¹¶é‡å»ºvolume
docker volume rm line-mgmt_backend_keys
docker-compose up -d backend
```

### é—®é¢˜ï¼šå¯†é’¥ä¸¢å¤±

**åŸå› **: Volumeè¢«åˆ é™¤

**è§£å†³**: ç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆæ–°å¯†é’¥ï¼Œä½†éœ€è¦é‡æ–°é…ç½®API Key

## ğŸ”„ æ›´æ–°è¯´æ˜

ä»æ—§ç‰ˆæœ¬å‡çº§æ—¶ï¼š
1. ç³»ç»Ÿä¼šè‡ªåŠ¨æ£€æµ‹å¹¶è¿ç§»åˆ°æ–°çš„ç®€åŒ–é…ç½®
2. RSAå¯†é’¥ä¼šåœ¨é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨ç”Ÿæˆ
3. æ— éœ€æ‰‹åŠ¨æ“ä½œ

