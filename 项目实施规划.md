# Lineè´¦å·ç®¡ç†ç³»ç»Ÿ - é¡¹ç›®å®æ–½è§„åˆ’

> **ç‰ˆæœ¬**: v2.0
> **æ›´æ–°æ—¥æœŸ**: 2025-12-22
> **æŠ€æœ¯æ ˆ**: Go + Vue3 + Element Plus + PostgreSQL + Redis

---

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®åç§°
Lineè´¦å·åˆ†ç»„ç®¡ç†ä¸è¿›çº¿ç»Ÿè®¡ç³»ç»Ÿ

### æ ¸å¿ƒåŠŸèƒ½
- åˆ†ç»„ï¼ˆæ¿€æ´»ç ï¼‰ç®¡ç†
- Lineè´¦å·ç®¡ç†ä¸ç›‘æ§
- è¿›çº¿ç»Ÿè®¡ä¸å»é‡
- åº•åº“ç®¡ç†
- å®¢æˆ·ç®¡ç†
- è·Ÿè¿›è®°å½•

### æŠ€æœ¯æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           å‰ç«¯å±‚ï¼ˆVue3ï¼‰                     â”‚
â”‚   Vue3 + Element Plus + Pinia + Axios       â”‚
â”‚   - ç®¡ç†åå°ï¼ˆç®¡ç†å‘˜/æ™®é€šç”¨æˆ·ï¼‰              â”‚
â”‚   - å­è´¦å·åå°ï¼ˆåˆ†ç»„æ•°æ®ï¼‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ HTTP/WebSocket
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           åç«¯å±‚ï¼ˆGoï¼‰                       â”‚
â”‚   Gin + GORM + WebSocket + JWT              â”‚
â”‚   - RESTful API                             â”‚
â”‚   - WebSocketæœåŠ¡ï¼ˆ800+å¹¶å‘ï¼‰                â”‚
â”‚   - æƒé™æ§åˆ¶                                 â”‚
â”‚   - å®šæ—¶ä»»åŠ¡                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚               â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
    â”‚ PostgreSQL â”‚   â”‚   Redis   â”‚
    â”‚  ä¸»å­˜å‚¨    â”‚   â”‚   ç¼“å­˜    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“… å¼€å‘é˜¶æ®µè§„åˆ’ï¼ˆ14å‘¨ï¼‰

### ç¬¬1å‘¨ï¼šé¡¹ç›®åˆå§‹åŒ–

#### åç«¯åˆå§‹åŒ–
- [x] åˆ›å»ºGoé¡¹ç›®ç»“æ„
- [x] é…ç½®Ginæ¡†æ¶
- [x] é›†æˆGORM
- [x] é…ç½®PostgreSQLè¿æ¥
- [x] é…ç½®Redisè¿æ¥
- [x] è®¾ç½®ç¯å¢ƒå˜é‡ç®¡ç†ï¼ˆviperï¼‰
- [x] é…ç½®æ—¥å¿—ç³»ç»Ÿï¼ˆzapï¼‰
- [x] ç¼–å†™Dockerfile

#### å‰ç«¯åˆå§‹åŒ–
- [x] åˆ›å»ºVue3é¡¹ç›®ï¼ˆViteï¼‰
- [x] å®‰è£…Element Plus
- [x] é…ç½®Vue Router
- [x] é…ç½®PiniaçŠ¶æ€ç®¡ç†
- [x] é…ç½®Axiosè¯·æ±‚å°è£…
- [x] é…ç½®ä»£ç†å’Œç¯å¢ƒå˜é‡
- [x] è®¾è®¡åŸºç¡€å¸ƒå±€
- [x] åˆ›å»ºæ‰€æœ‰APIå°è£…æ–‡ä»¶ï¼ˆ9ä¸ªæ¨¡å—ï¼‰
- [x] åˆ›å»ºç™»å½•é¡µé¢ï¼ˆç®¡ç†å‘˜/å­è´¦å·ï¼‰
- [x] åˆ›å»ºç®¡ç†åå°å¸ƒå±€å’Œå­è´¦å·å¸ƒå±€
- [x] åˆ›å»ºåŸºç¡€é¡µé¢ç»„ä»¶å ä½
- [x] åˆ›å»ºå·¥å…·å‡½æ•°ï¼ˆæ ¼å¼åŒ–ã€WebSocketã€è®¤è¯ç­‰ï¼‰
- [x] é…ç½®.gitignoreå¹¶ç§»é™¤éœ€æ±‚æ–¹æ¡ˆæ–‡æ¡£

#### æ•°æ®åº“åˆå§‹åŒ–
- [x] åˆ›å»ºæ•°æ®åº“
- [x] æ‰§è¡Œè¡¨ç»“æ„SQLï¼ˆ14å¼ è¡¨ï¼‰
- [x] åˆ›å»ºåˆ†åŒºè¡¨
- [x] åˆ›å»ºç´¢å¼•å’Œè§¦å‘å™¨
- [x] åˆ›å»ºè§†å›¾
- [x] æ’å…¥åˆå§‹ç®¡ç†å‘˜è´¦å·
- [x] ç¼–å†™æ•°æ®åº“è¿ç§»è„šæœ¬

---

### ç¬¬2å‘¨ï¼šè®¤è¯ä¸æƒé™ç³»ç»Ÿ

#### åç«¯å¼€å‘
- [x] JWT Tokenç”Ÿæˆä¸éªŒè¯
- [x] ä¸‰ç§ç™»å½•æ–¹å¼å®ç°
  - ç”¨æˆ·å+å¯†ç ï¼ˆç®¡ç†å‘˜/æ™®é€šç”¨æˆ·ï¼‰
  - æ¿€æ´»ç +å¯†ç ï¼ˆå­è´¦å·ï¼‰
- [x] æƒé™ä¸­é—´ä»¶
  - AdminRequired
  - UserRequired
  - SubAccountRequired
- [x] æ•°æ®è¿‡æ»¤ä¸­é—´ä»¶ï¼ˆæ ¹æ®è§’è‰²è¿‡æ»¤æ•°æ®ï¼‰
- [x] Sessionç®¡ç†ï¼ˆä½¿ç”¨Rediså­˜å‚¨ä¼šè¯ï¼Œæ”¯æŒTokené»‘åå•ã€æ´»è·ƒä¼šè¯æŸ¥è¯¢ï¼‰

#### å‰ç«¯å¼€å‘
- [x] ç™»å½•é¡µé¢ï¼ˆç®¡ç†å‘˜/å­è´¦å·ï¼‰
- [x] ç™»å½•é€»è¾‘ï¼ˆAxiosæ‹¦æˆªå™¨ï¼‰
- [x] Tokenå­˜å‚¨ï¼ˆlocalStorageï¼‰
- [x] è·¯ç”±å®ˆå«ï¼ˆæƒé™æ£€æŸ¥ï¼‰
- [x] ç”¨æˆ·ä¿¡æ¯çŠ¶æ€ç®¡ç†ï¼ˆPiniaï¼‰

#### APIæ¥å£
- [x] POST /api/auth/login - ç”¨æˆ·ç™»å½•
- [x] POST /api/auth/login-subaccount - å­è´¦å·ç™»å½•
- [x] POST /api/auth/logout - ç™»å‡º
- [x] GET /api/auth/me - è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- [x] POST /api/auth/refresh - åˆ·æ–°Token

---

### ç¬¬3å‘¨ï¼šåˆ†ç»„ç®¡ç†æ¨¡å—

#### åç«¯å¼€å‘
- [x] åˆ†ç»„CRUD Serviceå±‚
- [x] åˆ†ç»„APIæ¥å£
  - [x] GET /api/groups - åˆ—è¡¨ï¼ˆåˆ†é¡µã€ç­›é€‰ï¼‰
  - [x] POST /api/groups - åˆ›å»ºï¼ˆè‡ªåŠ¨ç”Ÿæˆæ¿€æ´»ç ï¼‰
  - [x] PUT /api/groups/:id - æ›´æ–°
  - [x] DELETE /api/groups/:id - åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰
  - [x] POST /api/groups/:id/regenerate-code - é‡æ–°ç”Ÿæˆæ¿€æ´»ç 
  - [x] GET /api/groups/categories - è·å–åˆ†ç»„åˆ†ç±»åˆ—è¡¨
- [x] åˆ›å»ºåˆ†ç»„æ—¶åˆå§‹åŒ–group_stats
- [x] åˆ†ç»„å½’ç±»ç®¡ç†ï¼ˆåˆ†ç±»æŸ¥è¯¢åŠŸèƒ½ï¼‰
- [x] æ‰¹é‡æ“ä½œæ¥å£
  - [x] POST /api/groups/batch/delete - æ‰¹é‡åˆ é™¤åˆ†ç»„
  - [x] POST /api/groups/batch/update - æ‰¹é‡æ›´æ–°åˆ†ç»„

#### å‰ç«¯å¼€å‘
- [ ] åˆ†ç»„ç®¡ç†é¡µé¢
  - ç­›é€‰åŒºåŸŸ
  - æ•°æ®è¡¨æ ¼
  - æ–°å¢/ç¼–è¾‘å¯¹è¯æ¡†
  - æ‰¹é‡æ“ä½œ
- [ ] åˆ†ç»„çŠ¶æ€å®æ—¶æ›´æ–°

---

### ç¬¬4å‘¨ï¼šLineè´¦å·ç®¡ç†æ¨¡å—

#### åç«¯å¼€å‘
- [ ] Lineè´¦å·CRUD Serviceå±‚
- [ ] Lineè´¦å·APIæ¥å£
  - GET /api/line-accounts - åˆ—è¡¨ï¼ˆç­›é€‰ã€åˆ†é¡µï¼‰
  - POST /api/line-accounts - åˆ›å»º
  - PUT /api/line-accounts/:id - æ›´æ–°
  - DELETE /api/line-accounts/:id - åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰
- [ ] äºŒç»´ç ç”ŸæˆæœåŠ¡
  - POST /api/line-accounts/:id/generate-qr
- [ ] åˆ›å»ºè´¦å·æ—¶åˆå§‹åŒ–line_account_stats
- [ ] è´¦å·çŠ¶æ€æ›´æ–°ï¼ˆæ›´æ–°group_statsï¼‰

#### å‰ç«¯å¼€å‘
- [ ] è´¦å·åˆ—è¡¨é¡µé¢
  - å¹³å°ç­›é€‰
  - ç­›é€‰åŒºåŸŸ
  - æ•°æ®è¡¨æ ¼
  - äºŒç»´ç é¢„è§ˆ
- [ ] æ‰¹é‡æ“ä½œï¼ˆç§»é™¤ã€å¼ºåˆ¶ä¸‹çº¿ï¼‰
- [ ] æ—¥å¿—è®°å½•å¼¹çª—

---

### ç¬¬5å‘¨ï¼šWebSocketæœåŠ¡ï¼ˆæ ¸å¿ƒï¼‰

#### åç«¯å¼€å‘
- [ ] WebSocketè¿æ¥ç®¡ç†å™¨
  - è¿æ¥æ± ç®¡ç†
  - å¤šæ¿€æ´»ç æ”¯æŒ
  - è¿æ¥è®¤è¯
- [ ] å¿ƒè·³æœºåˆ¶
  - 60ç§’å¿ƒè·³æ£€æµ‹
  - 65ç§’è¶…æ—¶å¤„ç†
- [ ] æ¶ˆæ¯è·¯ç”±ä¸å¤„ç†
  - heartbeat - å¿ƒè·³
  - sync_line_accounts - åŒæ­¥è´¦å·
  - incoming - è¿›çº¿æ•°æ®
  - customer_sync - å®¢æˆ·ä¿¡æ¯
  - follow_up_sync - è·Ÿè¿›è®°å½•
  - account_status_change - çŠ¶æ€å˜åŒ–
- [ ] æ¨é€æœåŠ¡ï¼ˆæœåŠ¡å™¨â†’å®¢æˆ·ç«¯ï¼‰
- [ ] æ¨é€æœåŠ¡ï¼ˆæœåŠ¡å™¨â†’å‰ç«¯ï¼‰

#### WebSocketè·¯å¾„
- /api/ws/client - Windowså®¢æˆ·ç«¯è¿æ¥
- /api/ws/dashboard - å‰ç«¯çœ‹æ¿è¿æ¥

---

### ç¬¬6å‘¨ï¼šè¿›çº¿ç»Ÿè®¡æ¨¡å—ï¼ˆæ ¸å¿ƒï¼‰

#### åç«¯å¼€å‘
- [ ] è¿›çº¿æ•°æ®å¤„ç†Service
  - æ¥æ”¶è¿›çº¿æ•°æ®
  - å»é‡åˆ¤æ–­ï¼ˆcurrent/globalï¼‰
  - è®°å½•incoming_logs
  - å¢é‡æ›´æ–°ç»Ÿè®¡è¡¨
  - æ·»åŠ åˆ°åº•åº“ï¼ˆå¦‚æœä¸é‡å¤ï¼‰
- [ ] å»é‡é€»è¾‘å®ç°
  - check_duplicate_current()
  - check_duplicate_global()
- [ ] ç»Ÿè®¡APIæ¥å£
  - GET /api/stats/group/:id - åˆ†ç»„ç»Ÿè®¡
  - GET /api/stats/account/:id - è´¦å·ç»Ÿè®¡
  - GET /api/stats/overview - æ€»è§ˆç»Ÿè®¡
- [ ] å®æ—¶æ¨é€ï¼ˆè¿›çº¿æ›´æ–°ï¼‰

#### å‰ç«¯å¼€å‘
- [ ] çº¿ç´¢åˆ—è¡¨é¡µé¢ï¼ˆæ€»çœ‹æ¿ï¼‰
  - ç­›é€‰åŒºåŸŸ
  - æ•°æ®è¡¨æ ¼
  - å±•å¼€/æŠ˜å åŠŸèƒ½
  - è¿›çº¿ç»Ÿè®¡å±•ç¤º
  - å®æ—¶æ•°æ®æ›´æ–°ï¼ˆWebSocketï¼‰

---

### ç¬¬7å‘¨ï¼šåº•åº“ç®¡ç†æ¨¡å—

#### åç«¯å¼€å‘
- [ ] åº•åº“CRUD Serviceå±‚
- [ ] å¯¼å…¥åŸå§‹è”ç³»äººåŠŸèƒ½
  - æ–‡ä»¶ä¸Šä¼ 
  - Excel/CSVè§£æ
  - æ‰¹é‡æ’å…¥contact_pool
  - å»é‡æ£€æŸ¥
- [ ] åº•åº“æŸ¥è¯¢API
  - GET /api/contact-pool/summary - ç»Ÿè®¡æ±‡æ€»
  - GET /api/contact-pool/list - åˆ—è¡¨ï¼ˆæŒ‰æ¿€æ´»ç +å¹³å°ï¼‰
  - GET /api/contact-pool/detail - è¯¦ç»†åˆ—è¡¨
- [ ] å¯¼å…¥æ‰¹æ¬¡ç®¡ç†

#### å‰ç«¯å¼€å‘
- [ ] åº•åº“ç®¡ç†é¡µé¢
  - ç»Ÿè®¡å¡ç‰‡
  - ä¸¤ä¸ªæ ‡ç­¾é¡µ
  - å¯¼å…¥å¯¹è¯æ¡†
  - æ–‡ä»¶ä¸Šä¼ ç»„ä»¶
  - è¯¦ç»†åˆ—è¡¨é¡µé¢

---

### ç¬¬8å‘¨ï¼šå®¢æˆ·ç®¡ç†æ¨¡å—

#### åç«¯å¼€å‘
- [ ] å®¢æˆ·CRUD Serviceå±‚
- [ ] å®¢æˆ·APIæ¥å£
  - GET /api/customers - åˆ—è¡¨ï¼ˆç­›é€‰ã€åˆ†é¡µï¼‰
  - GET /api/customers/:id - å®¢æˆ·è¯¦æƒ…
  - PUT /api/customers/:id - æ›´æ–°å®¢æˆ·ä¿¡æ¯
  - DELETE /api/customers/:id - åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰
- [ ] å®¢æˆ·ä¿¡æ¯åŒæ­¥å¤„ç†ï¼ˆä»Windowså®¢æˆ·ç«¯ï¼‰
- [ ] å®¢æˆ·ç±»å‹åˆ¤æ–­é€»è¾‘

#### å‰ç«¯å¼€å‘
- [ ] å®¢æˆ·åˆ—è¡¨é¡µé¢
  - å¹³å°ç­›é€‰
  - ç­›é€‰åŒºåŸŸ
  - æ•°æ®è¡¨æ ¼
  - è·Ÿè¿›è®°å½•æŒ‰é’®
- [ ] å®¢æˆ·è¯¦æƒ…å¯¹è¯æ¡†/é¡µé¢
  - åŸºæœ¬ä¿¡æ¯å±•ç¤º
  - ç¼–è¾‘è¡¨å•
  - ä¿å­˜æ›´æ–°

---

### ç¬¬9å‘¨ï¼šè·Ÿè¿›è®°å½•æ¨¡å—

#### åç«¯å¼€å‘
- [ ] è·Ÿè¿›è®°å½•CRUD Serviceå±‚
- [ ] è·Ÿè¿›è®°å½•APIæ¥å£
  - GET /api/follow-ups - åˆ—è¡¨ï¼ˆç­›é€‰ã€åˆ†é¡µï¼‰
  - POST /api/follow-ups - åˆ›å»º
  - PUT /api/follow-ups/:id - ç¼–è¾‘å†…å®¹
  - DELETE /api/follow-ups/:id - åˆ é™¤
  - POST /api/follow-ups/batch - æ‰¹é‡åˆ›å»º
- [ ] è·Ÿè¿›è®°å½•åŒæ­¥å¤„ç†ï¼ˆä»Windowså®¢æˆ·ç«¯ï¼‰

#### å‰ç«¯å¼€å‘
- [ ] è·Ÿè¿›è®°å½•é¡µé¢
  - ç­›é€‰åŒºåŸŸ
  - æ•°æ®è¡¨æ ¼
  - ç¼–è¾‘å¯¹è¯æ¡†
  - åˆ é™¤ç¡®è®¤

---

### ç¬¬10å‘¨ï¼šå®šæ—¶ä»»åŠ¡ä¸åå°æœåŠ¡

#### åç«¯å¼€å‘
- [ ] å®šæ—¶ä»»åŠ¡æ¡†æ¶ï¼ˆcronï¼‰
- [ ] æ¯æ—¥é‡ç½®ä»»åŠ¡
  - æ¯åˆ†é’Ÿæ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®
  - é‡ç½®group_stats.today_incoming
  - é‡ç½®line_account_stats.today_incoming
- [ ] å…¨é‡æ ¡å‡†ä»»åŠ¡
  - æ¯å¤©å‡Œæ™¨3ç‚¹æ‰§è¡Œ
  - é‡ç®—æ‰€æœ‰ç»Ÿè®¡æ•°æ®
  - é˜²æ­¢æ•°æ®æ¼‚ç§»
- [ ] ç¦»çº¿æ£€æµ‹ä»»åŠ¡
  - å®šæœŸæ£€æŸ¥WebSocketè¿æ¥
  - æ ‡è®°è¶…æ—¶ç¦»çº¿çš„è´¦å·
- [ ] åˆ†åŒºè‡ªåŠ¨åˆ›å»ºä»»åŠ¡
  - æ¯æœˆ1å·åˆ›å»ºä¸‹æœˆåˆ†åŒº
- [ ] æ•°æ®å½’æ¡£ä»»åŠ¡
  - å½’æ¡£12ä¸ªæœˆå‰çš„æ•°æ®

---

### ç¬¬11å‘¨ï¼šç”¨æˆ·ç®¡ç†ä¸å¤§æ¨¡å‹æ¨¡å—

#### åç«¯å¼€å‘ - ç”¨æˆ·ç®¡ç†
- [ ] ç”¨æˆ·ç®¡ç†APIï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰
  - GET /api/admin/users - ç”¨æˆ·åˆ—è¡¨
  - POST /api/admin/users - åˆ›å»ºæ™®é€šç”¨æˆ·
  - PUT /api/admin/users/:id - æ›´æ–°ç”¨æˆ·
  - DELETE /api/admin/users/:id - åˆ é™¤ç”¨æˆ·

#### åç«¯å¼€å‘ - å¤§æ¨¡å‹é…ç½®
- [ ] å¤§æ¨¡å‹é…ç½®APIï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰
  - GET /api/admin/llm/configs - é…ç½®åˆ—è¡¨
  - POST /api/admin/llm/configs - åˆ›å»ºé…ç½®
  - PUT /api/admin/llm/configs/:id - æ›´æ–°é…ç½®
  - DELETE /api/admin/llm/configs/:id - åˆ é™¤é…ç½®
  - POST /api/admin/llm/configs/:id/test - æµ‹è¯•è¿æ¥
- [ ] Promptæ¨¡æ¿API
  - GET /api/admin/llm/templates - æ¨¡æ¿åˆ—è¡¨
  - POST /api/admin/llm/templates - åˆ›å»ºæ¨¡æ¿
  - PUT /api/admin/llm/templates/:id - æ›´æ–°æ¨¡æ¿
  - DELETE /api/admin/llm/templates/:id - åˆ é™¤æ¨¡æ¿
- [ ] API KeyåŠ å¯†/è§£å¯†æœåŠ¡
- [ ] å¤§æ¨¡å‹è°ƒç”¨ä»£ç†æœåŠ¡
  - OpenAIé€‚é…å™¨
  - Claudeé€‚é…å™¨
  - é€šä¹‰åƒé—®é€‚é…å™¨
  - å…¶ä»–æä¾›å•†é€‚é…å™¨

#### åç«¯å¼€å‘ - Windowså®¢æˆ·ç«¯è°ƒç”¨æ¥å£
- [ ] GET /api/llm/configs - è·å–å¯ç”¨é…ç½®ï¼ˆä¸è¿”å›API Keyï¼‰
- [ ] POST /api/llm/call - è°ƒç”¨å¤§æ¨¡å‹
- [ ] POST /api/llm/call-template - ä½¿ç”¨æ¨¡æ¿è°ƒç”¨
- [ ] POST /api/llm/call-stream - æµå¼è°ƒç”¨ï¼ˆå¯é€‰ï¼‰
- [ ] GET /api/llm/templates - è·å–æ¨¡æ¿åˆ—è¡¨
- [ ] è°ƒç”¨è®°å½•Service
  - è®°å½•æ‰€æœ‰è°ƒç”¨
  - Tokenç»Ÿè®¡
  - æˆæœ¬ç»Ÿè®¡

#### å‰ç«¯å¼€å‘
- [ ] ç”¨æˆ·ç®¡ç†é¡µé¢ï¼ˆç®¡ç†å‘˜ï¼‰
- [ ] å¤§æ¨¡å‹é…ç½®é¡µé¢ï¼ˆç®¡ç†å‘˜ï¼‰
  - é…ç½®åˆ—è¡¨
  - æ–°å¢/ç¼–è¾‘é…ç½®å¯¹è¯æ¡†
  - Promptæ¨¡æ¿ç®¡ç†
  - æµ‹è¯•è¿æ¥åŠŸèƒ½
- [ ] å¤§æ¨¡å‹è°ƒç”¨è®°å½•é¡µé¢ï¼ˆç®¡ç†å‘˜ï¼‰
  - è°ƒç”¨è®°å½•åˆ—è¡¨
  - ç­›é€‰åŠŸèƒ½
  - æŸ¥çœ‹è¯¦æƒ…å¯¹è¯æ¡†
  - Tokenç»Ÿè®¡

---

### ç¬¬12å‘¨ï¼šå‰ç«¯ä¼˜åŒ–ä¸äº¤äº’

#### å‰ç«¯å¼€å‘
- [ ] ä¾§è¾¹æ å¯¼èˆªï¼ˆæ ¹æ®è§’è‰²æ˜¾ç¤ºä¸åŒèœå•ï¼‰
- [ ] é¢åŒ…å±‘å¯¼èˆª
- [ ] WebSocketè¿æ¥ç®¡ç†
  - è‡ªåŠ¨é‡è¿
  - æ–­çº¿æç¤º
  - å®æ—¶æ•°æ®æ›´æ–°
- [ ] æ•°æ®å¯è§†åŒ–
  - è¿›çº¿è¶‹åŠ¿å›¾ï¼ˆEChartsï¼‰
  - ç»Ÿè®¡å¡ç‰‡
  - å®æ—¶åˆ·æ–°åŠ¨ç”»
- [ ] å“åº”å¼å¸ƒå±€
- [ ] åŠ è½½çŠ¶æ€ä¼˜åŒ–
- [ ] é”™è¯¯å¤„ç†ä¸æç¤º

---

### ç¬¬13å‘¨ï¼šæµ‹è¯•ä¸ä¼˜åŒ–

#### åç«¯æµ‹è¯•
- [ ] å•å…ƒæµ‹è¯•
  - Serviceå±‚æµ‹è¯•
  - å»é‡é€»è¾‘æµ‹è¯•
  - ç»Ÿè®¡è®¡ç®—æµ‹è¯•
- [ ] APIé›†æˆæµ‹è¯•
- [ ] WebSocketæ€§èƒ½æµ‹è¯•
  - 800ä¸ªå¹¶å‘è¿æ¥æµ‹è¯•
  - å‹åŠ›æµ‹è¯•
  - å†…å­˜æ³„æ¼æ£€æµ‹
- [ ] æ•°æ®åº“æ€§èƒ½æµ‹è¯•
  - æŸ¥è¯¢ä¼˜åŒ–
  - ç´¢å¼•æ•ˆæœéªŒè¯

#### å‰ç«¯æµ‹è¯•
- [ ] ç»„ä»¶æµ‹è¯•
- [ ] E2Eæµ‹è¯•ï¼ˆå¯é€‰ï¼‰
- [ ] æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•

#### æ€§èƒ½ä¼˜åŒ–
- [ ] SQLæŸ¥è¯¢ä¼˜åŒ–
- [ ] Redisç¼“å­˜ä¼˜åŒ–
- [ ] WebSocketè¿æ¥ä¼˜åŒ–
- [ ] å‰ç«¯æ‰“åŒ…ä¼˜åŒ–

---

### ç¬¬14å‘¨ï¼šéƒ¨ç½²ä¸æ–‡æ¡£

#### éƒ¨ç½²å‡†å¤‡
- [ ] Dockeré•œåƒæ„å»º
  - åç«¯Goé•œåƒ
  - å‰ç«¯Nginxé•œåƒ
- [ ] docker-composeé…ç½®
  - PostgreSQL
  - Redis
  - Backend
  - Frontend
  - Nginx
- [ ] Nginxé…ç½®
  - åå‘ä»£ç†
  - WebSocketæ”¯æŒ
  - é™æ€æ–‡ä»¶æœåŠ¡
- [ ] SSLè¯ä¹¦é…ç½®

#### æ–‡æ¡£ç¼–å†™
- [x] APIæ–‡æ¡£è§„åˆ’ï¼ˆå·²å®Œæˆï¼‰
- [ ] Swaggeré›†æˆåˆ°Goé¡¹ç›®
  - é…ç½®swaggoå·¥å…·
  - æ·»åŠ æ¥å£æ³¨è§£
  - ç”Ÿæˆswagger.json
  - é…ç½®æ–‡æ¡£è®¿é—®è·¯ç”±
- [ ] APIæ–‡æ¡£ç¼–å†™
  - è®¤è¯æˆæƒæ¥å£æ–‡æ¡£
  - åˆ†ç»„ç®¡ç†æ¥å£æ–‡æ¡£
  - Lineè´¦å·ç®¡ç†æ¥å£æ–‡æ¡£
  - å®¢æˆ·ç®¡ç†æ¥å£æ–‡æ¡£
  - è·Ÿè¿›è®°å½•æ¥å£æ–‡æ¡£
  - ç»Ÿè®¡æ•°æ®æ¥å£æ–‡æ¡£
  - åº•åº“ç®¡ç†æ¥å£æ–‡æ¡£
  - å¤§æ¨¡å‹æœåŠ¡æ¥å£æ–‡æ¡£
  - WebSocketæ¥å£æ–‡æ¡£
- [ ] æ•°æ®åº“æ–‡æ¡£
  - ERå›¾ç”Ÿæˆ
  - è¡¨ç»“æ„è¯´æ˜
  - ç´¢å¼•å’Œçº¦æŸè¯´æ˜
  - åˆ†åŒºç­–ç•¥è¯´æ˜
- [ ] éƒ¨ç½²æ–‡æ¡£
  - Dockeréƒ¨ç½²æŒ‡å—
  - ç¯å¢ƒé…ç½®è¯´æ˜
  - ç›‘æ§å’Œæ—¥å¿—é…ç½®
  - å¤‡ä»½æ¢å¤æ–¹æ¡ˆ
- [ ] Windowså®¢æˆ·ç«¯å¯¹æ¥æ–‡æ¡£
  - WebSocketæ¶ˆæ¯åè®®
  - æ•°æ®åŒæ­¥æµç¨‹
  - é”™è¯¯å¤„ç†æœºåˆ¶
- [ ] ç”¨æˆ·ä½¿ç”¨æ‰‹å†Œ
  - ç®¡ç†å‘˜æ“ä½œæŒ‡å—
  - æ™®é€šç”¨æˆ·æ“ä½œæŒ‡å—
  - å­è´¦å·ä½¿ç”¨è¯´æ˜

---

## ğŸ“‚ é¡¹ç›®ç›®å½•ç»“æ„

### åç«¯ï¼ˆGoï¼‰

```
backend/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go                    # åº”ç”¨å…¥å£
â”‚
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ models/                        # GORMæ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ user.go
â”‚   â”‚   â”œâ”€â”€ group.go
â”‚   â”‚   â”œâ”€â”€ line_account.go
â”‚   â”‚   â”œâ”€â”€ group_stats.go
â”‚   â”‚   â”œâ”€â”€ line_account_stats.go
â”‚   â”‚   â”œâ”€â”€ incoming_log.go
â”‚   â”‚   â”œâ”€â”€ contact_pool.go
â”‚   â”‚   â”œâ”€â”€ customer.go
â”‚   â”‚   â”œâ”€â”€ follow_up_record.go
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ schemas/                       # è¯·æ±‚/å“åº”ç»“æ„ä½“
â”‚   â”‚   â”œâ”€â”€ auth.go
â”‚   â”‚   â”œâ”€â”€ group.go
â”‚   â”‚   â”œâ”€â”€ line_account.go
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ handlers/                      # HTTPå¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ auth.go
â”‚   â”‚   â”œâ”€â”€ group.go
â”‚   â”‚   â”œâ”€â”€ line_account.go
â”‚   â”‚   â”œâ”€â”€ customer.go
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                      # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ auth_service.go
â”‚   â”‚   â”œâ”€â”€ group_service.go
â”‚   â”‚   â”œâ”€â”€ line_account_service.go
â”‚   â”‚   â”œâ”€â”€ incoming_service.go       # è¿›çº¿å¤„ç†ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”‚   â”œâ”€â”€ dedup_service.go          # å»é‡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ stats_service.go          # ç»Ÿè®¡æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ qr_service.go             # äºŒç»´ç ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ llm_service.go            # å¤§æ¨¡å‹è°ƒç”¨æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ llm_provider.go           # å¤§æ¨¡å‹æä¾›å•†é€‚é…
â”‚   â”‚   â””â”€â”€ encryption_service.go     # åŠ å¯†æœåŠ¡ï¼ˆAPI KeyåŠ å¯†ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ websocket/                     # WebSocketæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ manager.go                # è¿æ¥ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ client_handler.go         # Windowså®¢æˆ·ç«¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ dashboard_handler.go      # å‰ç«¯çœ‹æ¿å¤„ç†
â”‚   â”‚   â”œâ”€â”€ message_handler.go        # æ¶ˆæ¯å¤„ç†
â”‚   â”‚   â””â”€â”€ hub.go                    # æ¶ˆæ¯å¹¿æ’­ä¸­å¿ƒ
â”‚   â”‚
â”‚   â”œâ”€â”€ middleware/                    # ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ auth.go                   # è®¤è¯ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ permission.go             # æƒé™ä¸­é—´ä»¶
â”‚   â”‚   â”œâ”€â”€ cors.go                   # CORS
â”‚   â”‚   â”œâ”€â”€ logger.go                 # æ—¥å¿—
â”‚   â”‚   â””â”€â”€ recovery.go               # é”™è¯¯æ¢å¤
â”‚   â”‚
â”‚   â”œâ”€â”€ scheduler/                     # å®šæ—¶ä»»åŠ¡
â”‚   â”‚   â”œâ”€â”€ scheduler.go              # ä»»åŠ¡è°ƒåº¦å™¨
â”‚   â”‚   â”œâ”€â”€ daily_reset.go            # æ¯æ—¥é‡ç½®
â”‚   â”‚   â”œâ”€â”€ stats_calibration.go      # ç»Ÿè®¡æ ¡å‡†
â”‚   â”‚   â””â”€â”€ partition_manager.go      # åˆ†åŒºç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                         # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ crypto.go                 # åŠ å¯†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ jwt.go                    # JWTå·¥å…·
â”‚   â”‚   â”œâ”€â”€ validator.go              # æ•°æ®éªŒè¯
â”‚   â”‚   â””â”€â”€ time.go                   # æ—¶é—´å¤„ç†
â”‚   â”‚
â”‚   â””â”€â”€ config/                        # é…ç½®
â”‚       â”œâ”€â”€ config.go                 # é…ç½®ç»“æ„
â”‚       â””â”€â”€ database.go               # æ•°æ®åº“è¿æ¥
â”‚
â”œâ”€â”€ pkg/                               # å…¬å…±åŒ…
â”‚   â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ redis/
â”‚   â””â”€â”€ logger/
â”‚
â”œâ”€â”€ migrations/                        # æ•°æ®åº“è¿ç§»
â”‚   â”œâ”€â”€ 001_create_users.sql
â”‚   â”œâ”€â”€ 002_create_groups.sql
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ scripts/                           # è„šæœ¬
â”‚   â”œâ”€â”€ init_db.sh
â”‚   â””â”€â”€ create_admin.go
â”‚
â”œâ”€â”€ static/                            # é™æ€æ–‡ä»¶
â”‚   â””â”€â”€ qrcodes/
â”‚
â”œâ”€â”€ tests/                             # æµ‹è¯•
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
â”‚
â”œâ”€â”€ go.mod
â”œâ”€â”€ go.sum
â”œâ”€â”€ .env.example
â”œâ”€â”€ Dockerfile
â””â”€â”€ README.md
```

---

### å‰ç«¯ï¼ˆVue3ï¼‰

```
frontend/
â”œâ”€â”€ public/
â”‚   â””â”€â”€ favicon.ico
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                           # APIå°è£…
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”œâ”€â”€ group.js
â”‚   â”‚   â”œâ”€â”€ lineAccount.js
â”‚   â”‚   â”œâ”€â”€ customer.js
â”‚   â”‚   â”œâ”€â”€ followUp.js
â”‚   â”‚   â”œâ”€â”€ stats.js
â”‚   â”‚   â”œâ”€â”€ contactPool.js
â”‚   â”‚   â”œâ”€â”€ llm.js                    # å¤§æ¨¡å‹API
â”‚   â”‚   â””â”€â”€ user.js                   # ç”¨æˆ·ç®¡ç†API
â”‚   â”‚
â”‚   â”œâ”€â”€ assets/                        # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                    # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ LineStatusBadge.vue
â”‚   â”‚   â”œâ”€â”€ QRCodeViewer.vue
â”‚   â”‚   â”œâ”€â”€ StatsCard.vue
â”‚   â”‚   â”œâ”€â”€ TableFilter.vue
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚
â”‚   â”œâ”€â”€ views/                         # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.vue             # ç™»å½•é¡µ
â”‚   â”‚   â”‚   â””â”€â”€ SubAccountLogin.vue   # å­è´¦å·ç™»å½•
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ admin/                     # ç®¡ç†åå°
â”‚   â”‚   â”‚   â”œâ”€â”€ Layout.vue            # å¸ƒå±€
â”‚   â”‚   â”‚   â”œâ”€â”€ Dashboard.vue         # é¦–é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ GroupManage.vue       # åˆ†ç»„ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ AccountList.vue       # è´¦å·åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ LeadsList.vue         # çº¿ç´¢åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ContactPool.vue       # åº•åº“ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ CustomerList.vue      # å®¢æˆ·åˆ—è¡¨
â”‚   â”‚   â”‚   â”œâ”€â”€ FollowUpRecords.vue   # è·Ÿè¿›è®°å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ UserManage.vue        # ç”¨æˆ·ç®¡ç†ï¼ˆç®¡ç†å‘˜ï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ LLMConfig.vue         # å¤§æ¨¡å‹é…ç½®ï¼ˆç®¡ç†å‘˜ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ LLMCallLogs.vue       # å¤§æ¨¡å‹è°ƒç”¨è®°å½•ï¼ˆç®¡ç†å‘˜ï¼‰
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ subaccount/                # å­è´¦å·åå°ï¼ˆæ•°æ®è¿‡æ»¤ï¼‰
â”‚   â”‚       â””â”€â”€ Layout.vue
â”‚   â”‚
â”‚   â”œâ”€â”€ router/                        # è·¯ç”±é…ç½®
â”‚   â”‚   â””â”€â”€ index.js
â”‚   â”‚
â”‚   â”œâ”€â”€ store/                         # PiniaçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ auth.js                   # è®¤è¯çŠ¶æ€
â”‚   â”‚   â”œâ”€â”€ user.js                   # ç”¨æˆ·ä¿¡æ¯
â”‚   â”‚   â”œâ”€â”€ websocket.js              # WebSocketè¿æ¥
â”‚   â”‚   â””â”€â”€ stats.js                  # ç»Ÿè®¡æ•°æ®
â”‚   â”‚
â”‚   â”œâ”€â”€ styles/                        # æ ·å¼æ–‡ä»¶ï¼ˆLessï¼‰
â”‚   â”‚   â”œâ”€â”€ variables.less            # æ ·å¼å˜é‡
â”‚   â”‚   â”œâ”€â”€ mixins.less               # æ ·å¼æ··åˆ
â”‚   â”‚   â””â”€â”€ index.less                # å…¨å±€æ ·å¼
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                         # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ request.js                # Axioså°è£…
â”‚   â”‚   â”œâ”€â”€ websocket.js              # WebSocketå°è£…
â”‚   â”‚   â”œâ”€â”€ auth.js                   # è®¤è¯å·¥å…·
â”‚   â”‚   â””â”€â”€ format.js                 # æ ¼å¼åŒ–å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ App.vue
â”‚   â””â”€â”€ main.js
â”‚
â”œâ”€â”€ index.html
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.js
â”œâ”€â”€ .env.development
â”œâ”€â”€ .env.production
â””â”€â”€ Dockerfile
```

---

## ğŸ³ Dockeréƒ¨ç½²ç»“æ„

### docker-compose.yml

```yaml
version: '3.8'

services:
  # PostgreSQLæ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    container_name: line-postgres
    environment:
      POSTGRES_DB: line_management
      POSTGRES_USER: lineuser
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./migrations:/docker-entrypoint-initdb.d
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U lineuser"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Redisç¼“å­˜
  redis:
    image: redis:7-alpine
    container_name: line-redis
    command: redis-server --appendonly yes
    volumes:
      - redis_data:/data
    ports:
      - "6379:6379"

  # åç«¯APIï¼ˆGoï¼‰
  backend:
    build: ./backend
    container_name: line-backend
    environment:
      DATABASE_URL: postgres://lineuser:${POSTGRES_PASSWORD}@postgres:5432/line_management?sslmode=disable
      REDIS_URL: redis://redis:6379/0
      JWT_SECRET: ${JWT_SECRET}
      GIN_MODE: release
    ports:
      - "8080:8080"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_started
    volumes:
      - backend_static:/app/static
    restart: unless-stopped

  # å‰ç«¯ï¼ˆVue3 + Nginxï¼‰
  frontend:
    build: ./frontend
    container_name: line-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped

volumes:
  postgres_data:
  redis_data:
  backend_static:
```

---

## ğŸ“Š æ€§èƒ½ç›®æ ‡

### WebSocketæ€§èƒ½
- **å¹¶å‘è¿æ¥**: 800+ï¼ˆç›®æ ‡1000ï¼‰
- **å¿ƒè·³é¢‘ç‡**: 60ç§’/æ¬¡
- **æ¶ˆæ¯å»¶è¿Ÿ**: <50ms
- **æœåŠ¡å™¨é…ç½®**: 2æ ¸4G

### APIæ€§èƒ½
- **å“åº”æ—¶é—´**: <100msï¼ˆ99%è¯·æ±‚ï¼‰
- **QPS**: 1000+
- **å¹¶å‘ç”¨æˆ·**: 100+

### æ•°æ®åº“æ€§èƒ½
- **æŸ¥è¯¢å“åº”**: <50msï¼ˆå¤æ‚æŸ¥è¯¢ï¼‰
- **å†™å…¥TPS**: 500+
- **è¿æ¥æ•°**: 100

---

## ğŸ¯ å…³é”®æŠ€æœ¯ç‚¹

### 1. WebSocketè¿æ¥ç®¡ç†ï¼ˆGoï¼‰

```go
type ConnectionManager struct {
    clients    map[string]*Client      // key: activation_code + conn_id
    broadcast  chan []byte
    register   chan *Client
    unregister chan *Client
    mu         sync.RWMutex
}

type Client struct {
    ID             string
    ActivationCode string
    GroupID        uint
    Conn           *websocket.Conn
    Send           chan []byte
    LastHeartbeat  time.Time
}

// æ”¯æŒ800+å¹¶å‘è¿æ¥
func (m *ConnectionManager) Run() {
    for {
        select {
        case client := <-m.register:
            m.mu.Lock()
            m.clients[client.ID] = client
            m.mu.Unlock()
            
        case client := <-m.unregister:
            m.mu.Lock()
            delete(m.clients, client.ID)
            m.mu.Unlock()
            close(client.Send)
            
        case message := <-m.broadcast:
            m.mu.RLock()
            for _, client := range m.clients {
                select {
                case client.Send <- message:
                default:
                    close(client.Send)
                    delete(m.clients, client.ID)
                }
            }
            m.mu.RUnlock()
        }
    }
}
```

### 2. å¢é‡æ›´æ–°ç»Ÿè®¡ï¼ˆGoï¼‰

```go
func (s *IncomingService) RecordIncoming(data *IncomingData) error {
    return s.db.Transaction(func(tx *gorm.DB) error {
        // 1. å»é‡åˆ¤æ–­
        isDuplicate := s.CheckDuplicate(data)
        
        // 2. è®°å½•è¿›çº¿æ—¥å¿—
        log := &IncomingLog{
            LineAccountID:   data.LineAccountID,
            GroupID:         data.GroupID,
            IncomingLineID:  data.IncomingLineID,
            IsDuplicate:     isDuplicate,
            IncomingTime:    time.Now(),
        }
        if err := tx.Create(log).Error; err != nil {
            return err
        }
        
        // 3. å¢é‡æ›´æ–°è´¦å·ç»Ÿè®¡ï¼ˆç›´æ¥UPDATE +1ï¼‰
        if err := tx.Model(&LineAccountStats{}).
            Where("line_account_id = ?", data.LineAccountID).
            Updates(map[string]interface{}{
                "total_incoming":     gorm.Expr("total_incoming + ?", 1),
                "today_incoming":     gorm.Expr("today_incoming + ?", 1),
                "duplicate_incoming": gorm.Expr("duplicate_incoming + ?", ifDup(isDuplicate, 1, 0)),
            }).Error; err != nil {
            return err
        }
        
        // 4. å¢é‡æ›´æ–°åˆ†ç»„ç»Ÿè®¡
        if err := tx.Model(&GroupStats{}).
            Where("group_id = ?", data.GroupID).
            Updates(map[string]interface{}{
                "total_incoming":     gorm.Expr("total_incoming + ?", 1),
                "today_incoming":     gorm.Expr("today_incoming + ?", 1),
                "duplicate_incoming": gorm.Expr("duplicate_incoming + ?", ifDup(isDuplicate, 1, 0)),
            }).Error; err != nil {
            return err
        }
        
        // 5. æ·»åŠ åˆ°åº•åº“ï¼ˆå¦‚æœä¸é‡å¤ï¼‰
        if !isDuplicate {
            // ...
        }
        
        return nil
    })
}
```

### 3. å‰ç«¯WebSocketè¿æ¥ï¼ˆVue3ï¼‰

```javascript
// composables/useWebSocket.js
import { ref, onMounted, onUnmounted } from 'vue'

export function useWebSocket(url) {
  const ws = ref(null)
  const connected = ref(false)
  const reconnectTimer = ref(null)
  
  const connect = () => {
    ws.value = new WebSocket(url)
    
    ws.value.onopen = () => {
      connected.value = true
      console.log('WebSocketè¿æ¥æˆåŠŸ')
    }
    
    ws.value.onmessage = (event) => {
      const message = JSON.parse(event.data)
      handleMessage(message)
    }
    
    ws.value.onerror = (error) => {
      console.error('WebSocketé”™è¯¯:', error)
    }
    
    ws.value.onclose = () => {
      connected.value = false
      console.log('WebSocketæ–­å¼€ï¼Œ5ç§’åé‡è¿')
      reconnectTimer.value = setTimeout(connect, 5000)
    }
  }
  
  const disconnect = () => {
    if (reconnectTimer.value) {
      clearTimeout(reconnectTimer.value)
    }
    if (ws.value) {
      ws.value.close()
    }
  }
  
  onMounted(connect)
  onUnmounted(disconnect)
  
  return { ws, connected, connect, disconnect }
}
```

---

## âœ… å·²ç¡®è®¤æŠ€æœ¯æ ˆ

### åç«¯
- **è¯­è¨€**: Go 1.21+
- **æ¡†æ¶**: Gin
- **ORM**: GORM 2.0
- **WebSocket**: gorilla/websocket
- **JWT**: golang-jwt
- **å®šæ—¶ä»»åŠ¡**: robfig/cron
- **é…ç½®**: spf13/viper
- **æ—¥å¿—**: uber-go/zap
- **Redis**: go-redis

### å‰ç«¯
- **æ¡†æ¶**: Vue 3
- **UIåº“**: Element Plus
- **æ„å»ºå·¥å…·**: Vite
- **è·¯ç”±**: Vue Router 4
- **çŠ¶æ€ç®¡ç†**: Pinia
- **HTTP**: Axios
- **æ ·å¼**: Less CSS
- **å›¾è¡¨**: EChartsï¼ˆå¯é€‰ï¼‰

### æ•°æ®åº“
- **ä¸»æ•°æ®åº“**: PostgreSQL 15
- **ç¼“å­˜**: Redis 7
- **è¿æ¥æ± **: pgx

### éƒ¨ç½²
- **å®¹å™¨åŒ–**: Docker + docker-compose
- **åå‘ä»£ç†**: Nginx
- **SSL**: Let's Encrypt

---

## ğŸ“‹ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **âœ… å·²å®Œæˆ**: ç¬¬1å‘¨çš„é¡¹ç›®åˆå§‹åŒ–ï¼ˆåç«¯+å‰ç«¯ï¼‰
2. **âœ… å·²å®Œæˆ**: ç¬¬2å‘¨ - è®¤è¯ä¸æƒé™ç³»ç»Ÿå¼€å‘
3. **âœ… è¿›è¡Œä¸­**: ç¬¬3å‘¨ - åˆ†ç»„ç®¡ç†æ¨¡å—å¼€å‘ï¼ˆåç«¯å·²å®Œæˆï¼‰
4. **ä¸‹ä¸€æ­¥**: ç¬¬3å‘¨ - åˆ†ç»„ç®¡ç†æ¨¡å—å‰ç«¯å¼€å‘
5. **ä¼˜å…ˆå¼€å‘**: WebSocketæœåŠ¡ï¼ˆç¬¬5å‘¨ï¼‰+ è¿›çº¿ç»Ÿè®¡ï¼ˆç¬¬6å‘¨ï¼‰
5. **å¹¶è¡Œå¼€å‘**: å‰åç«¯å¯ä»¥åŒæ­¥å¼€å‘
6. **æŒç»­æµ‹è¯•**: æ¯å‘¨æœ«è¿›è¡Œé›†æˆæµ‹è¯•

## ğŸ“Š å½“å‰è¿›åº¦

### ç¬¬1å‘¨ï¼šé¡¹ç›®åˆå§‹åŒ– âœ…
- âœ… åç«¯åˆå§‹åŒ–å®Œæˆï¼ˆGoé¡¹ç›®ç»“æ„ã€Ginã€GORMã€æ•°æ®åº“ã€Redisã€æ—¥å¿—ç­‰ï¼‰
- âœ… å‰ç«¯åˆå§‹åŒ–å®Œæˆï¼ˆVue3é¡¹ç›®ã€Element Plusã€Routerã€Piniaã€Axiosã€APIå°è£…ã€é¡µé¢ç»„ä»¶ç­‰ï¼‰
- âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼ˆ14å¼ è¡¨ã€åˆ†åŒºã€ç´¢å¼•ã€è§¦å‘å™¨ã€è§†å›¾ã€åˆå§‹æ•°æ®ï¼‰

### ç¬¬2å‘¨ï¼šè®¤è¯ä¸æƒé™ç³»ç»Ÿ âœ…
- âœ… åç«¯ï¼šJWT Tokenç”Ÿæˆä¸éªŒè¯ã€ä¸‰ç§ç™»å½•æ–¹å¼ã€æƒé™ä¸­é—´ä»¶ã€æ•°æ®è¿‡æ»¤ä¸­é—´ä»¶
- âœ… å‰ç«¯ï¼šç™»å½•é¡µé¢ã€è·¯ç”±å®ˆå«ã€çŠ¶æ€ç®¡ç†ï¼ˆå·²å®Œæˆï¼‰
- âœ… APIæ¥å£ï¼šæ‰€æœ‰è®¤è¯ç›¸å…³æ¥å£å·²å®Œæˆ

### ç¬¬3å‘¨ï¼šåˆ†ç»„ç®¡ç†æ¨¡å—ï¼ˆåç«¯ï¼‰âœ…
- âœ… åˆ†ç»„CRUD Serviceå±‚ï¼ˆGroupServiceï¼‰
- âœ… åˆ†ç»„APIæ¥å£ï¼ˆ6ä¸ªæ¥å£å…¨éƒ¨å®Œæˆï¼‰
  - âœ… GET /api/groups - åˆ—è¡¨ï¼ˆåˆ†é¡µã€ç­›é€‰ã€å…³è”ç»Ÿè®¡ä¿¡æ¯ï¼‰
  - âœ… POST /api/groups - åˆ›å»ºï¼ˆè‡ªåŠ¨ç”Ÿæˆ8ä½æ¿€æ´»ç ï¼‰
  - âœ… PUT /api/groups/:id - æ›´æ–°
  - âœ… DELETE /api/groups/:id - åˆ é™¤ï¼ˆè½¯åˆ é™¤ï¼‰
  - âœ… POST /api/groups/:id/regenerate-code - é‡æ–°ç”Ÿæˆæ¿€æ´»ç 
  - âœ… GET /api/groups/categories - è·å–åˆ†ç»„åˆ†ç±»åˆ—è¡¨
- âœ… åˆ›å»ºåˆ†ç»„æ—¶è‡ªåŠ¨åˆå§‹åŒ–group_stats
- âœ… åˆ†ç»„å½’ç±»ç®¡ç†ï¼ˆæ”¯æŒåˆ†ç±»æŸ¥è¯¢ï¼‰
- âœ… æ•°æ®è¿‡æ»¤ä¸­é—´ä»¶é›†æˆï¼ˆæ ¹æ®è§’è‰²è‡ªåŠ¨è¿‡æ»¤æ•°æ®ï¼‰
- âœ… ç»Ÿä¸€APIå“åº”æ ¼å¼
- âœ… æ‰¹é‡æ“ä½œæ¥å£
  - âœ… æ‰¹é‡åˆ é™¤åˆ†ç»„ï¼ˆPOST /api/groups/batch/deleteï¼‰
  - âœ… æ‰¹é‡æ›´æ–°åˆ†ç»„ï¼ˆPOST /api/groups/batch/updateï¼‰
- âœ… Swagger APIæ–‡æ¡£ç”Ÿæˆ

**å½“å‰çŠ¶æ€**: ç¬¬3å‘¨åˆ†ç»„ç®¡ç†æ¨¡å—åç«¯å¼€å‘å·²å®Œæˆï¼Œå¯ä»¥å¼€å§‹å‰ç«¯å¼€å‘


