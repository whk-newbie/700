# ç”¨æˆ·ç®¡ç† - éœ€æ±‚æ–¹æ¡ˆ

> **ç‰ˆæœ¬**: v1.0
> **æ›´æ–°æ—¥æœŸ**: 2025-12-21
> **è¯´æ˜**: ç®¡ç†å‘˜ç®¡ç†æ™®é€šç”¨æˆ·çš„åŠŸèƒ½ï¼ˆä»…ç®¡ç†å‘˜å¯è®¿é—®ï¼‰

---

## ğŸ“‹ é¡µé¢æ¦‚è¿°

### æ ¸å¿ƒåŠŸèƒ½
ç®¡ç†å‘˜åˆ›å»ºå’Œç®¡ç†æ™®é€šç”¨æˆ·ï¼Œé…ç½®ç”¨æˆ·çš„åˆ†ç»„æ•°é™åˆ¶ç­‰æƒé™ã€‚

### é¡µé¢è·¯å¾„
`/admin/user-manage`

**æƒé™**: â­ ä»…ç®¡ç†å‘˜å¯è®¿é—®

---

## ğŸ” ç­›é€‰åŠŸèƒ½

### ç­›é€‰æ¡ä»¶

#### 1. ç”¨æˆ·åæœç´¢
- **å­—æ®µ**: `username`
- **ç±»å‹**: æ–‡æœ¬è¾“å…¥æ¡†
- **å ä½ç¬¦**: "è¯·è¾“å…¥ç”¨æˆ·å"
- **åŒ¹é…æ–¹å¼**: æ¨¡ç³Šæœç´¢

#### 2. é‚®ç®±æœç´¢
- **å­—æ®µ**: `email`
- **ç±»å‹**: æ–‡æœ¬è¾“å…¥æ¡†
- **å ä½ç¬¦**: "è¯·è¾“å…¥é‚®ç®±"
- **åŒ¹é…æ–¹å¼**: æ¨¡ç³Šæœç´¢

#### 3. çŠ¶æ€ç­›é€‰
- **å­—æ®µ**: `is_active`
- **ç±»å‹**: ä¸‹æ‹‰é€‰æ‹©
- **é€‰é¡¹**:
  - å…¨éƒ¨
  - æ­£å¸¸
  - å·²ç¦ç”¨

### ç­›é€‰æ“ä½œæŒ‰é’®
```
[ğŸ” æœç´¢]  [ğŸ”„ é‡é€‰]
```

---

## ğŸ“Š åˆ—è¡¨å­—æ®µå®šä¹‰

### ç”¨æˆ·åˆ—è¡¨å­—æ®µ

| åºå· | å­—æ®µå | è¯´æ˜ |
|-----|--------|------|
| 1 | ID | ç”¨æˆ·ID |
| 2 | ç”¨æˆ·å | ç™»å½•ç”¨æˆ·å |
| 3 | é‚®ç®± | é‚®ç®±åœ°å€ |
| 4 | åˆ†ç»„æ•°é™åˆ¶ | å¯åˆ›å»ºçš„æœ€å¤§åˆ†ç»„æ•° |
| 5 | å½“å‰åˆ†ç»„æ•° | å·²åˆ›å»ºçš„åˆ†ç»„æ•° |
| 6 | çŠ¶æ€ | å¯ç”¨/ç¦ç”¨ |
| 7 | åˆ›å»ºæ—¶é—´ | åˆ›å»ºæ—¶é—´ |
| 8 | æ“ä½œ | æ“ä½œæŒ‰é’® |

### å­—æ®µè¯¦ç»†è¯´æ˜

#### 4. åˆ†ç»„æ•°é™åˆ¶
- **å­—æ®µå**: `max_groups`
- **ç±»å‹**: `INTEGER`
- **è¯´æ˜**: è¯¥ç”¨æˆ·æœ€å¤šå¯ä»¥åˆ›å»ºçš„åˆ†ç»„æ•°é‡
- **æ˜¾ç¤ºæ–¹å¼**: æ•°å­—æˆ–æ–‡å­—

**ç¤ºä¾‹**:
```
æ— é™åˆ¶       (max_groups = NULL æˆ– 0)
10          (max_groups = 10)
50          (max_groups = 50)
100         (max_groups = 100)
```

#### 5. å½“å‰åˆ†ç»„æ•°
- **å­—æ®µå**: `current_groups`
- **ç±»å‹**: `INTEGER`ï¼ˆæŸ¥è¯¢è®¡ç®—ï¼‰
- **è¯´æ˜**: è¯¥ç”¨æˆ·å·²åˆ›å»ºçš„åˆ†ç»„æ•°é‡
- **æ˜¾ç¤ºæ–¹å¼**: æ•°å­—ï¼Œå¦‚æœæ¥è¿‘é™åˆ¶åˆ™é«˜äº®æç¤º

**ç¤ºä¾‹**:
```
5 / æ— é™åˆ¶
8 / 10       (æ¥è¿‘é™åˆ¶ï¼Œæ©™è‰²æ˜¾ç¤º)
10 / 10      (å·²è¾¾ä¸Šé™ï¼Œçº¢è‰²æ˜¾ç¤º)
```

**è®¡ç®—é€»è¾‘**:
```sql
SELECT COUNT(*) 
FROM groups 
WHERE user_id = {user_id} 
  AND deleted_at IS NULL
```

---

## âš™ï¸ åŠŸèƒ½æŒ‰é’®

### æ–°å¢ç”¨æˆ·

**æŒ‰é’®**: `â• æ–°å¢ç”¨æˆ·`

**å¯¹è¯æ¡†å­—æ®µ**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–°å¢ç”¨æˆ·                  [å…³é—­ âœ•] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚
â”‚  åŸºæœ¬ä¿¡æ¯                             â”‚
â”‚  ç”¨æˆ·åï¼š    [____________]  *å¿…å¡«   â”‚
â”‚  å¯†ç ï¼š      [____________]  *å¿…å¡«   â”‚
â”‚  ç¡®è®¤å¯†ç ï¼š  [____________]  *å¿…å¡«   â”‚
â”‚  é‚®ç®±ï¼š      [____________]  å¯é€‰    â”‚
â”‚                                       â”‚
â”‚  æƒé™é…ç½®                             â”‚
â”‚  åˆ†ç»„æ•°é™åˆ¶ï¼š                         â”‚
â”‚    â—‹ æ— é™åˆ¶                          â”‚
â”‚    â— é™åˆ¶æ•°é‡ï¼š[10] ä¸ª               â”‚
â”‚                                       â”‚
â”‚  çŠ¶æ€ï¼š                               â”‚
â”‚    â˜‘ å¯ç”¨                            â”‚
â”‚                                       â”‚
â”‚         [ä¿å­˜]  [å–æ¶ˆ]               â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å­—æ®µè¯´æ˜**:
- **ç”¨æˆ·å**: 3-50å­—ç¬¦ï¼Œå­—æ¯æ•°å­—ä¸‹åˆ’çº¿
- **å¯†ç **: æœ€å°‘8ä½ï¼ŒåŒ…å«å­—æ¯å’Œæ•°å­—
- **åˆ†ç»„æ•°é™åˆ¶**: 
  - é€‰æ‹©"æ— é™åˆ¶"ï¼šmax_groups = NULL
  - é€‰æ‹©"é™åˆ¶æ•°é‡"ï¼šè¾“å…¥å…·ä½“æ•°å­—ï¼ˆ1-10000ï¼‰

---

### ç¼–è¾‘ç”¨æˆ·

**æŒ‰é’®**: åˆ—è¡¨ä¸­çš„"ç¼–è¾‘"

**å¯¹è¯æ¡†**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¼–è¾‘ç”¨æˆ·                  [å…³é—­ âœ•] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                       â”‚
â”‚  åŸºæœ¬ä¿¡æ¯                             â”‚
â”‚  ç”¨æˆ·åï¼š    user1 (ä¸å¯ä¿®æ”¹)        â”‚
â”‚  é‚®ç®±ï¼š      [user1@qq.com  ]       â”‚
â”‚                                       â”‚
â”‚  ä¿®æ”¹å¯†ç ï¼ˆå¯é€‰ï¼‰                     â”‚
â”‚  æ–°å¯†ç ï¼š    [____________]          â”‚
â”‚  ç¡®è®¤å¯†ç ï¼š  [____________]          â”‚
â”‚                                       â”‚
â”‚  æƒé™é…ç½®                             â”‚
â”‚  åˆ†ç»„æ•°é™åˆ¶ï¼š                         â”‚
â”‚    â—‹ æ— é™åˆ¶                          â”‚
â”‚    â— é™åˆ¶æ•°é‡ï¼š[10] ä¸ª               â”‚
â”‚                                       â”‚
â”‚  å½“å‰å·²åˆ›å»ºï¼š5 ä¸ªåˆ†ç»„                â”‚
â”‚                                       â”‚
â”‚  çŠ¶æ€ï¼š                               â”‚
â”‚    â˜‘ å¯ç”¨                            â”‚
â”‚                                       â”‚
â”‚         [ä¿å­˜]  [å–æ¶ˆ]               â”‚
â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éªŒè¯è§„åˆ™**:
- å¦‚æœä¿®æ”¹åˆ†ç»„æ•°é™åˆ¶ï¼Œæ–°é™åˆ¶ä¸èƒ½å°äºå½“å‰å·²åˆ›å»ºçš„åˆ†ç»„æ•°
- ä¾‹å¦‚ï¼šç”¨æˆ·å·²åˆ›å»º8ä¸ªåˆ†ç»„ï¼Œåˆ™é™åˆ¶ä¸èƒ½å°äº8

---

### å…¶ä»–æ“ä½œ

**ç¦ç”¨ç”¨æˆ·**:
- æŒ‰é’®ï¼šåˆ—è¡¨ä¸­çš„"ç¦ç”¨"
- ç¡®è®¤æç¤ºï¼š"ç¡®å®šè¦ç¦ç”¨ç”¨æˆ· xxx å—ï¼Ÿç¦ç”¨åè¯¥ç”¨æˆ·æ— æ³•ç™»å½•ï¼Œå…¶åˆ†ç»„ä¹Ÿæ— æ³•ä½¿ç”¨ã€‚"
- æ•ˆæœï¼šè®¾ç½® `is_active = false`

**åˆ é™¤ç”¨æˆ·**:
- æŒ‰é’®ï¼šåˆ—è¡¨ä¸­çš„"åˆ é™¤"
- ç¡®è®¤æç¤ºï¼š"ç¡®å®šè¦åˆ é™¤ç”¨æˆ· xxx å—ï¼Ÿåˆ é™¤åè¯¥ç”¨æˆ·åŠå…¶æ‰€æœ‰åˆ†ç»„ã€æ•°æ®éƒ½å°†è¢«åˆ é™¤ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼"
- æ•ˆæœï¼šè½¯åˆ é™¤ï¼ˆè®¾ç½® `deleted_at`ï¼‰
- çº§è”ï¼šè¯¥ç”¨æˆ·çš„æ‰€æœ‰åˆ†ç»„å’Œæ•°æ®ä¹Ÿä¼šè¢«è½¯åˆ é™¤ï¼ˆON DELETE CASCADEï¼‰

---

## ğŸ“± é¡µé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¥ ç”¨æˆ·ç®¡ç†ï¼ˆç®¡ç†å‘˜ä¸“ç”¨ï¼‰                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  [ç­›é€‰åŒºåŸŸ]                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ ç”¨æˆ·å   â”‚ é‚®ç®±     â”‚ çŠ¶æ€     â”‚                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                               â”‚
â”‚  [ğŸ” æœç´¢]  [ğŸ”„ é‡é€‰]                                        â”‚
â”‚                                                               â”‚
â”‚  [â• æ–°å¢ç”¨æˆ·]                                               â”‚
â”‚                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  [æ•°æ®è¡¨æ ¼]                                                   â”‚
â”‚  â”Œâ”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”â”‚
â”‚  â”‚IDâ”‚ç”¨æˆ·å  â”‚é‚®ç®±      â”‚åˆ†ç»„é™åˆ¶  â”‚å½“å‰åˆ†ç»„â”‚çŠ¶æ€â”‚æ—¶é—´â”‚æ“ä½œâ”‚â”‚
â”‚  â”œâ”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤â”‚
â”‚  â”‚1 â”‚user1   â”‚user1@qq  â”‚æ— é™åˆ¶    â”‚5ä¸ª     â”‚æ­£å¸¸â”‚12-2â”‚ç¼–è¾‘â”‚â”‚
â”‚  â”‚2 â”‚user2   â”‚user2@qq  â”‚10ä¸ª      â”‚8/10    â”‚æ­£å¸¸â”‚12-2â”‚ç¼–è¾‘â”‚â”‚
â”‚  â”‚3 â”‚user3   â”‚user3@qq  â”‚50ä¸ª      â”‚50/50   â”‚æ­£å¸¸â”‚12-2â”‚ç¼–è¾‘â”‚â”‚
â”‚  â””â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜â”‚
â”‚                                                               â”‚
â”‚  å…± 50 æ¡    [20æ¡/é¡µ â–¼]  [â—€] [1][2][3] [â–¶]                 â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” åˆ†ç»„æ•°é™åˆ¶é€»è¾‘

### åˆ›å»ºåˆ†ç»„æ—¶çš„æ£€æŸ¥

**åç«¯é€»è¾‘**:
```go
func (s *GroupService) CreateGroup(userID uint, data *CreateGroupRequest) error {
    // 1. è·å–ç”¨æˆ·ä¿¡æ¯
    var user models.User
    if err := s.db.First(&user, userID).Error; err != nil {
        return err
    }
    
    // 2. æ£€æŸ¥åˆ†ç»„æ•°é™åˆ¶
    if user.MaxGroups != nil && *user.MaxGroups > 0 {
        // æŸ¥è¯¢å½“å‰å·²åˆ›å»ºçš„åˆ†ç»„æ•°
        var currentCount int64
        s.db.Model(&models.Group{}).
            Where("user_id = ? AND deleted_at IS NULL", userID).
            Count(&currentCount)
        
        // æ£€æŸ¥æ˜¯å¦è¶…é™
        if int(currentCount) >= *user.MaxGroups {
            return errors.New(fmt.Sprintf(
                "å·²è¾¾åˆ°åˆ†ç»„æ•°ä¸Šé™ï¼ˆ%dä¸ªï¼‰ï¼Œæ— æ³•åˆ›å»ºæ–°åˆ†ç»„", 
                *user.MaxGroups
            ))
        }
    }
    
    // 3. åˆ›å»ºåˆ†ç»„
    group := &models.Group{
        UserID:         userID,
        ActivationCode: generateActivationCode(),
        // ...
    }
    
    return s.db.Create(group).Error
}
```

### å‰ç«¯æç¤º

**åœºæ™¯1**: ç”¨æˆ·åœ¨åˆ†ç»„ç®¡ç†é¡µé¢ç‚¹å‡»"æ–°å¢æ¿€æ´»ç "

```javascript
// åˆ›å»ºå‰æ£€æŸ¥
try {
  await createGroup(data)
  ElMessage.success('åˆ›å»ºæˆåŠŸ')
} catch (error) {
  if (error.message.includes('åˆ†ç»„æ•°ä¸Šé™')) {
    ElMessage.error('å·²è¾¾åˆ°åˆ†ç»„æ•°ä¸Šé™ï¼Œæ— æ³•åˆ›å»ºæ–°åˆ†ç»„ï¼è¯·è”ç³»ç®¡ç†å‘˜æå‡é™é¢ã€‚')
  } else {
    ElMessage.error('åˆ›å»ºå¤±è´¥ï¼š' + error.message)
  }
}
```

**åœºæ™¯2**: å‰ç«¯ä¸»åŠ¨æ˜¾ç¤ºé™åˆ¶ä¿¡æ¯

```vue
<!-- åœ¨åˆ†ç»„ç®¡ç†é¡µé¢é¡¶éƒ¨æ˜¾ç¤º -->
<el-alert 
  v-if="userInfo.max_groups"
  :title="`å½“å‰åˆ†ç»„æ•°ï¼š${currentGroups}/${userInfo.max_groups}`"
  :type="currentGroups >= userInfo.max_groups ? 'error' : 'info'"
  :closable="false"
/>
```

---

## ğŸ“‹ APIæ¥å£

### 1. è·å–ç”¨æˆ·åˆ—è¡¨

**æ¥å£**: `GET /api/admin/users`

**æŸ¥è¯¢å‚æ•°**:
- `username`: ç”¨æˆ·åæœç´¢
- `email`: é‚®ç®±æœç´¢
- `is_active`: çŠ¶æ€ç­›é€‰
- `page`: é¡µç 
- `page_size`: æ¯é¡µæ•°é‡

**å“åº”**:
```json
{
  "success": true,
  "total": 50,
  "page": 1,
  "page_size": 20,
  "data": [
    {
      "id": 1,
      "username": "user1",
      "email": "user1@qq.com",
      "max_groups": null,
      "current_groups": 5,
      "is_active": true,
      "created_at": "2025-12-20 10:00:00"
    },
    {
      "id": 2,
      "username": "user2",
      "email": "user2@qq.com",
      "max_groups": 10,
      "current_groups": 8,
      "is_active": true,
      "created_at": "2025-12-21 15:30:00"
    }
  ]
}
```

---

### 2. åˆ›å»ºç”¨æˆ·

**æ¥å£**: `POST /api/admin/users`

**è¯·æ±‚**:
```json
{
  "username": "user3",
  "password": "password123",
  "email": "user3@qq.com",
  "max_groups": 10,          // nullæˆ–0è¡¨ç¤ºæ— é™åˆ¶
  "is_active": true
}
```

**å“åº”**:
```json
{
  "success": true,
  "data": {
    "id": 3,
    "username": "user3",
    "email": "user3@qq.com",
    "max_groups": 10,
    "is_active": true,
    "created_at": "2025-12-21 16:00:00"
  }
}
```

---

### 3. æ›´æ–°ç”¨æˆ·

**æ¥å£**: `PUT /api/admin/users/:id`

**è¯·æ±‚**:
```json
{
  "email": "new_email@qq.com",
  "max_groups": 20,          // ä¿®æ”¹åˆ†ç»„æ•°é™åˆ¶
  "password": "new_password", // å¯é€‰ï¼šä¿®æ”¹å¯†ç 
  "is_active": true
}
```

**éªŒè¯è§„åˆ™**:
```go
// å¦‚æœä¿®æ”¹max_groupsï¼ŒéªŒè¯ä¸èƒ½å°äºå½“å‰å·²åˆ›å»ºæ•°
if req.MaxGroups != nil && *req.MaxGroups > 0 {
    var currentCount int64
    db.Model(&Group{}).
        Where("user_id = ? AND deleted_at IS NULL", userID).
        Count(&currentCount)
    
    if int(currentCount) > *req.MaxGroups {
        return errors.New(fmt.Sprintf(
            "è¯¥ç”¨æˆ·å·²åˆ›å»º%dä¸ªåˆ†ç»„ï¼Œä¸èƒ½è®¾ç½®ä¸º%d", 
            currentCount, *req.MaxGroups
        ))
    }
}
```

---

### 4. åˆ é™¤ç”¨æˆ·

**æ¥å£**: `DELETE /api/admin/users/:id`

**å“åº”**:
```json
{
  "success": true,
  "message": "ç”¨æˆ·å·²åˆ é™¤"
}
```

**è¯´æ˜**: è½¯åˆ é™¤ï¼Œçº§è”åˆ é™¤è¯¥ç”¨æˆ·çš„æ‰€æœ‰åˆ†ç»„å’Œæ•°æ®

---

## ğŸ’¾ æ•°æ®åº“ç›¸å…³

### usersè¡¨å­—æ®µè¡¥å……

```sql
-- å·²åœ¨usersè¡¨ä¸­æ·»åŠ 
max_groups INTEGER DEFAULT NULL  -- NULLæˆ–0=æ— é™åˆ¶ï¼Œ>0=å…·ä½“é™åˆ¶
```

### æŸ¥è¯¢ç”¨æˆ·æ—¶é™„å¸¦åˆ†ç»„æ•°

```sql
SELECT 
    u.id,
    u.username,
    u.email,
    u.max_groups,
    u.is_active,
    u.created_at,
    COUNT(g.id) as current_groups      -- å½“å‰åˆ†ç»„æ•°
FROM users u
LEFT JOIN groups g ON g.user_id = u.id AND g.deleted_at IS NULL
WHERE u.deleted_at IS NULL 
  AND u.role = 'user'
GROUP BY u.id;
```

---

## ğŸ¯ ä¸šåŠ¡è§„åˆ™

### 1. åˆ†ç»„æ•°é™åˆ¶è§„åˆ™

| é…ç½®å€¼ | è¯´æ˜ |
|-------|------|
| NULL | æ— é™åˆ¶ï¼ˆé»˜è®¤ï¼‰ |
| 0 | æ— é™åˆ¶ |
| > 0 | å…·ä½“é™åˆ¶æ•°é‡ |

### 2. åˆ›å»ºåˆ†ç»„æ—¶çš„æ£€æŸ¥æµç¨‹

```
1. ç”¨æˆ·ç‚¹å‡»"æ–°å¢æ¿€æ´»ç "
   â†“
2. åç«¯æ¥æ”¶è¯·æ±‚
   â†“
3. æŸ¥è¯¢ç”¨æˆ·çš„max_groupsé…ç½®
   â†“
4. å¦‚æœæœ‰é™åˆ¶ï¼ˆmax_groups > 0ï¼‰
   - æŸ¥è¯¢å½“å‰å·²åˆ›å»ºçš„åˆ†ç»„æ•°
   - å¦‚æœ >= max_groupsï¼Œè¿”å›é”™è¯¯
   â†“
5. å¦‚æœæ— é™åˆ¶æˆ–æœªè¶…é™
   - åˆ›å»ºåˆ†ç»„
   - åˆå§‹åŒ–ç»Ÿè®¡è¡¨
   â†“
6. è¿”å›æˆåŠŸ
```

### 3. ä¿®æ”¹é™åˆ¶çš„éªŒè¯

**è§„åˆ™**: æ–°çš„é™åˆ¶æ•°ä¸èƒ½å°äºå½“å‰å·²åˆ›å»ºæ•°

**ç¤ºä¾‹**:
- ç”¨æˆ·å·²åˆ›å»º8ä¸ªåˆ†ç»„
- ç®¡ç†å‘˜ä¿®æ”¹é™åˆ¶ä¸º5 â†’ âŒ æ‹’ç»ï¼ˆ"è¯¥ç”¨æˆ·å·²åˆ›å»º8ä¸ªåˆ†ç»„ï¼Œä¸èƒ½è®¾ç½®ä¸º5"ï¼‰
- ç®¡ç†å‘˜ä¿®æ”¹é™åˆ¶ä¸º10 â†’ âœ… å…è®¸
- ç®¡ç†å‘˜ä¿®æ”¹ä¸ºæ— é™åˆ¶ â†’ âœ… å…è®¸

---

## ğŸ“Š ç»Ÿè®¡ä¿¡æ¯ï¼ˆé¡µé¢é¡¶éƒ¨å¡ç‰‡ï¼‰

### ç”¨æˆ·ç»Ÿè®¡å¡ç‰‡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ€»ç”¨æˆ·æ•°   â”‚  æ´»è·ƒç”¨æˆ·   â”‚  æ€»åˆ†ç»„æ•°   â”‚  åœ¨çº¿è´¦å·   â”‚
â”‚     50      â”‚     45      â”‚    230      â”‚    180      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¯´æ˜**:
- **æ€»ç”¨æˆ·æ•°**: æ‰€æœ‰æ™®é€šç”¨æˆ·ï¼ˆä¸åŒ…æ‹¬ç®¡ç†å‘˜ï¼‰
- **æ´»è·ƒç”¨æˆ·**: is_active = true çš„ç”¨æˆ·æ•°
- **æ€»åˆ†ç»„æ•°**: æ‰€æœ‰ç”¨æˆ·çš„åˆ†ç»„æ€»æ•°
- **åœ¨çº¿è´¦å·**: æ‰€æœ‰åˆ†ç»„çš„åœ¨çº¿Lineè´¦å·æ€»æ•°

---

## ğŸ”§ Goåç«¯å®ç°è¦ç‚¹

### Serviceå±‚ç¤ºä¾‹

```go
// internal/services/user_service.go

type UserService struct {
    db *gorm.DB
}

// åˆ›å»ºç”¨æˆ·
func (s *UserService) CreateUser(req *CreateUserRequest, adminID uint) (*models.User, error) {
    // 1. å¯†ç å“ˆå¸Œ
    hashedPassword, err := bcrypt.GenerateFromPassword([]byte(req.Password), bcrypt.DefaultCost)
    if err != nil {
        return nil, err
    }
    
    // 2. åˆ›å»ºç”¨æˆ·
    user := &models.User{
        Username:     req.Username,
        PasswordHash: string(hashedPassword),
        Email:        req.Email,
        Role:         "user",
        MaxGroups:    req.MaxGroups,  // NULLè¡¨ç¤ºæ— é™åˆ¶
        IsActive:     true,
        CreatedBy:    &adminID,
    }
    
    if err := s.db.Create(user).Error; err != nil {
        return nil, err
    }
    
    return user, nil
}

// æ£€æŸ¥åˆ†ç»„æ•°é™åˆ¶
func (s *UserService) CheckGroupLimit(userID uint) error {
    var user models.User
    if err := s.db.First(&user, userID).Error; err != nil {
        return err
    }
    
    // å¦‚æœæ²¡æœ‰é™åˆ¶ï¼Œç›´æ¥è¿”å›
    if user.MaxGroups == nil || *user.MaxGroups == 0 {
        return nil
    }
    
    // æŸ¥è¯¢å½“å‰åˆ†ç»„æ•°
    var currentCount int64
    s.db.Model(&models.Group{}).
        Where("user_id = ? AND deleted_at IS NULL", userID).
        Count(&currentCount)
    
    if int(currentCount) >= *user.MaxGroups {
        return fmt.Errorf("å·²è¾¾åˆ°åˆ†ç»„æ•°ä¸Šé™ï¼ˆ%d/%dï¼‰", currentCount, *user.MaxGroups)
    }
    
    return nil
}
```

---

## ğŸ¨ å‰ç«¯é¡µé¢è¦ç‚¹

### åˆ†ç»„åˆ—è¡¨æ˜¾ç¤ºé™é¢æç¤º

```vue
<!-- GroupManage.vue -->
<template>
  <div class="group-manage">
    <!-- é™é¢æç¤º -->
    <el-alert
      v-if="userInfo.max_groups"
      :title="`åˆ†ç»„æ•°é‡ï¼š${stats.current_groups}/${userInfo.max_groups}${stats.current_groups >= userInfo.max_groups ? ' (å·²è¾¾ä¸Šé™)' : ''}`"
      :type="stats.current_groups >= userInfo.max_groups ? 'error' : 'info'"
      style="margin-bottom: 20px"
      :closable="false"
    />
    
    <!-- æ–°å¢æŒ‰é’® -->
    <el-button 
      type="primary" 
      @click="handleAdd"
      :disabled="stats.current_groups >= userInfo.max_groups"
    >
      â• æ–°å¢æ¿€æ´»ç 
    </el-button>
  </div>
</template>
```

---

## âœ… å·²ç¡®è®¤éœ€æ±‚

- [x] ç®¡ç†å‘˜å¯é…ç½®ç”¨æˆ·çš„åˆ†ç»„æ•°é™åˆ¶
- [x] é»˜è®¤æ— é™åˆ¶ï¼ˆNULLï¼‰
- [x] åˆ›å»ºåˆ†ç»„æ—¶è‡ªåŠ¨æ£€æŸ¥é™åˆ¶
- [x] ä¿®æ”¹é™åˆ¶æ—¶éªŒè¯ä¸èƒ½å°äºå½“å‰æ•°é‡
- [x] å‰ç«¯æ˜¾ç¤ºåˆ†ç»„æ•°ä½¿ç”¨æƒ…å†µ
- [x] è¾¾åˆ°ä¸Šé™æ—¶ç¦ç”¨æ–°å¢æŒ‰é’®
- [x] ç”¨æˆ·ç®¡ç†é¡µé¢è®¾è®¡
- [x] APIæ¥å£è®¾è®¡
- [x] æ•°æ®åº“å­—æ®µè®¾è®¡


