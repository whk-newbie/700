# Line账号管理系统 - 状态码定义

> **版本**: v1.0  
> **更新日期**: 2025-12-21  
> **说明**: 系统统一的错误状态码和响应码定义

---

## 📋 状态码体系说明

本系统采用 HTTP 状态码 + 业务状态码的双重状态码体系：

- **HTTP 状态码**: 表示 HTTP 协议层面的状态（200, 400, 401, 403, 404, 500 等）
- **业务状态码**: 表示具体业务错误类型（code 字段，4位数字）

### 响应格式

```json
{
  "code": 1001,           // 业务状态码
  "message": "错误描述",   // 错误信息
  "data": null,           // 数据（成功时返回）
  "timestamp": "2025-12-21T10:00:00Z"
}
```

---

## 🔢 状态码分类

### 1xxx - 通用错误

| 状态码 | HTTP状态码 | 说明 | 示例场景 |
|--------|-----------|------|---------|
| 1000 | 200 | 成功 | 请求成功 |
| 1001 | 400 | 参数错误 | 缺少必填参数、参数格式错误 |
| 1002 | 400 | 参数验证失败 | 邮箱格式错误、手机号格式错误 |
| 1003 | 400 | 请求体解析失败 | JSON格式错误 |
| 1004 | 400 | 请求方法不支持 | 使用了错误的HTTP方法 |
| 1005 | 413 | 请求体过大 | 上传文件超过限制 |
| 1006 | 415 | 不支持的媒体类型 | Content-Type错误 |

### 2xxx - 认证与授权错误

| 状态码 | HTTP状态码 | 说明 | 示例场景 |
|--------|-----------|------|---------|
| 2001 | 401 | 未登录 | Token缺失或过期 |
| 2002 | 401 | Token无效 | Token格式错误、已失效 |
| 2003 | 401 | Token已过期 | Token超过有效期 |
| 2004 | 401 | 登录失败 | 用户名或密码错误 |
| 2005 | 401 | 激活码无效 | 激活码不存在或已禁用 |
| 2006 | 401 | 激活码密码错误 | 子账号登录密码错误 |
| 2007 | 403 | 权限不足 | 非管理员访问管理员接口 |
| 2008 | 403 | 无操作权限 | 普通用户操作其他用户的数据 |
| 2009 | 403 | 账号已禁用 | 用户账号被禁用 |
| 2010 | 403 | 分组已禁用 | 分组（激活码）被禁用 |

### 3xxx - 资源不存在错误

| 状态码 | HTTP状态码 | 说明 | 示例场景 |
|--------|-----------|------|---------|
| 3001 | 404 | 用户不存在 | 查询的用户ID不存在 |
| 3002 | 404 | 分组不存在 | 查询的分组ID不存在 |
| 3003 | 404 | 激活码不存在 | 查询的激活码不存在 |
| 3004 | 404 | Line账号不存在 | 查询的Line账号ID不存在 |
| 3005 | 404 | 客户不存在 | 查询的客户ID不存在 |
| 3006 | 404 | 跟进记录不存在 | 查询的跟进记录ID不存在 |
| 3007 | 404 | 底库记录不存在 | 查询的底库记录不存在 |
| 3008 | 404 | 大模型配置不存在 | 查询的大模型配置ID不存在 |
| 3009 | 404 | 资源不存在 | 通用资源不存在 |

### 4xxx - 业务逻辑错误

| 状态码 | HTTP状态码 | 说明 | 示例场景 |
|--------|-----------|------|---------|
| 4001 | 400 | 用户名已存在 | 创建用户时用户名重复 |
| 4002 | 400 | 激活码已存在 | 激活码重复（理论上不会发生） |
| 4003 | 400 | Line账号已存在 | 同一分组下Line账号重复 |
| 4004 | 400 | 分组名称已存在 | 分组名称重复 |
| 4005 | 400 | 账号已达上限 | 分组账号数量超过限制 |
| 4006 | 400 | 无法删除分组 | 分组下还有Line账号 |
| 4007 | 400 | 无法删除账号 | 账号还有关联数据 |
| 4008 | 400 | 去重范围无效 | 去重范围参数错误 |
| 4009 | 400 | 置零时间格式错误 | 置零时间格式不正确 |
| 4010 | 400 | 导入文件格式错误 | Excel/CSV格式不正确 |
| 4011 | 400 | 导入数据为空 | 导入文件没有有效数据 |
| 4012 | 400 | 导入数据重复 | 导入的数据已存在 |
| 4013 | 400 | 进线数据无效 | 进线数据格式错误 |
| 4014 | 400 | 客户类型无效 | 客户类型参数错误 |
| 4015 | 400 | 平台类型无效 | 平台类型参数错误（非line/line_business） |
| 4016 | 400 | 统计时间范围无效 | 统计查询时间范围错误 |
| 4017 | 400 | 无法重置统计 | 重置统计失败 |
| 4018 | 400 | 二维码生成失败 | 生成二维码时出错 |

### 5xxx - 数据操作错误

| 状态码 | HTTP状态码 | 说明 | 示例场景 |
|--------|-----------|------|---------|
| 5001 | 500 | 数据库连接失败 | 数据库连接异常 |
| 5002 | 500 | 数据库查询失败 | SQL查询执行失败 |
| 5003 | 500 | 数据库写入失败 | 数据插入/更新失败 |
| 5004 | 500 | 数据库事务失败 | 事务回滚 |
| 5005 | 500 | Redis连接失败 | Redis连接异常 |
| 5006 | 500 | Redis操作失败 | Redis读写失败 |
| 5007 | 500 | 数据完整性错误 | 外键约束、唯一约束冲突 |
| 5008 | 500 | 数据格式错误 | 数据序列化/反序列化失败 |

### 6xxx - WebSocket错误

| 状态码 | HTTP状态码 | 说明 | 示例场景 |
|--------|-----------|------|---------|
| 6001 | 400 | WebSocket连接失败 | 建立WebSocket连接失败 |
| 6002 | 400 | WebSocket认证失败 | 连接时认证失败 |
| 6003 | 400 | WebSocket消息格式错误 | 消息JSON格式错误 |
| 6004 | 400 | WebSocket消息类型未知 | 未知的消息类型 |
| 6005 | 400 | WebSocket心跳超时 | 心跳超时（65秒） |
| 6006 | 400 | WebSocket连接已存在 | 同一激活码已有连接 |
| 6007 | 400 | WebSocket连接不存在 | 连接已断开 |
| 6008 | 400 | WebSocket消息处理失败 | 处理消息时出错 |
| 6009 | 400 | WebSocket广播失败 | 推送消息失败 |

### 7xxx - 外部服务错误

| 状态码 | HTTP状态码 | 说明 | 示例场景 |
|--------|-----------|------|---------|
| 7001 | 502 | 大模型API调用失败 | 调用OpenAI/Claude失败 |
| 7002 | 502 | 大模型API超时 | 大模型响应超时 |
| 7003 | 502 | 大模型API Key无效 | API Key错误或过期 |
| 7004 | 502 | 大模型配置错误 | 大模型配置参数错误 |
| 7005 | 502 | 大模型配额不足 | API调用次数超限 |
| 7006 | 502 | 大模型服务不可用 | 大模型服务暂时不可用 |
| 7007 | 502 | 文件上传服务失败 | 文件上传到OSS失败 |
| 7008 | 502 | 二维码服务失败 | 调用二维码生成服务失败 |

### 8xxx - 系统错误

| 状态码 | HTTP状态码 | 说明 | 示例场景 |
|--------|-----------|------|---------|
| 8001 | 500 | 内部服务器错误 | 未预期的系统错误 |
| 8002 | 500 | 服务不可用 | 服务暂时不可用 |
| 8003 | 503 | 服务过载 | 服务器负载过高 |
| 8004 | 500 | 配置错误 | 系统配置错误 |
| 8005 | 500 | 加密/解密失败 | JWT生成、密码加密失败 |
| 8006 | 500 | 文件操作失败 | 文件读写失败 |
| 8007 | 500 | 定时任务执行失败 | 定时任务出错 |
| 8008 | 500 | 日志记录失败 | 日志系统错误 |

### 9xxx - 业务状态（非错误）

| 状态码 | HTTP状态码 | 说明 | 示例场景 |
|--------|-----------|------|---------|
| 9001 | 200 | 数据为空 | 查询结果为空（非错误） |
| 9002 | 200 | 操作成功但无变化 | 更新操作但数据未变化 |
| 9003 | 200 | 部分成功 | 批量操作部分成功 |
| 9004 | 200 | 需要确认 | 删除操作需要二次确认 |

---

## 📝 状态码使用规范

### 1. 成功响应

```json
{
  "code": 1000,
  "message": "操作成功",
  "data": {
    // 返回的数据
  },
  "timestamp": "2025-12-21T10:00:00Z"
}
```

### 2. 错误响应

```json
{
  "code": 2004,
  "message": "用户名或密码错误",
  "data": null,
  "timestamp": "2025-12-21T10:00:00Z"
}
```

### 3. 分页响应

```json
{
  "code": 1000,
  "message": "查询成功",
  "data": {
    "list": [...],
    "pagination": {
      "page": 1,
      "page_size": 10,
      "total": 100,
      "total_pages": 10
    }
  },
  "timestamp": "2025-12-21T10:00:00Z"
}
```

### 4. WebSocket消息格式

```json
{
  "type": "incoming",
  "code": 1000,
  "message": "进线数据更新",
  "data": {
    // 消息数据
  },
  "timestamp": "2025-12-21T10:00:00Z"
}
```

---

## 🔍 状态码查找表

### 按场景查找

#### 认证相关
- 未登录: 2001
- 登录失败: 2004
- Token过期: 2003
- 权限不足: 2007

#### 资源相关
- 用户不存在: 3001
- 分组不存在: 3002
- Line账号不存在: 3004
- 客户不存在: 3005

#### 业务逻辑
- 用户名已存在: 4001
- 账号已达上限: 4005
- 无法删除分组: 4006
- 导入文件格式错误: 4010

#### WebSocket
- 连接失败: 6001
- 认证失败: 6002
- 心跳超时: 6005
- 消息格式错误: 6003

#### 大模型
- API调用失败: 7001
- API Key无效: 7003
- 配额不足: 7005

---

## ✅ 状态码扩展说明

1. **新增状态码**: 按照分类规则，在对应范围内新增
2. **状态码文档**: 所有状态码必须在此文档中记录
3. **前端映射**: 前端需要维护状态码到错误提示的映射表
4. **日志记录**: 所有错误状态码都应该记录到日志系统

---

## 📚 相关文档

- [API文档规划.md](API文档规划.md) - API接口文档规范
- [项目实施规划.md](项目实施规划.md) - 项目开发计划

