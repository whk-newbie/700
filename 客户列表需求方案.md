# 客户列表管理 - 需求方案

> **版本**: v1.0
> **更新日期**: 2025-12-21
> **说明**: 基于CEO SCRM系统客户列表页面设计，移除标签和共享跟进功能

---

## 📋 页面概述

### 核心功能
客户列表用于管理和查看所有客户信息。开启了'线索分析'的激活码，或在社交账号上对客户添加了'客户画像'信息，才会上报客户信息。

### 页面路径
`/customer-list`

### 页面说明
开启了'线索分析'的激活码，或在社交账号上对客户添加了'客户画像'信息，才会上报客户信息

---

## 🏷️ 平台筛选

### 平台类型选择

**位置**: 页面顶部

**显示方式**: 复选框组

**平台类型**:
```
平台：
☑ 全选
☑ Line
☑ Line Business
```

**功能**:
- 支持多选
- 全选：勾选所有平台
- 单选：只显示特定平台的客户

---

## 🔍 筛选功能

### 筛选条件

#### 1. 时间范围筛选
- **字段**: `created_at` 或 `updated_at`
- **类型**: 日期范围选择器
- **显示**: 
  ```
  [开始时间] ~ [截止时间]
  ```

#### 2. 激活码筛选
- **字段**: `activation_code`
- **类型**: 下拉选择 + 文本输入框组合
- **下拉选项**: 
  - 激活码
  - 其他字段（可选）
- **输入框**: 模糊搜索

**显示**:
```
[激活码 ▼]  [请输入         ]
```

#### 3. 国家筛选
- **字段**: `country`
- **类型**: 下拉选择
- **选项**: 
  - 全部国家
  - 日本
  - 台湾
  - 泰国
  - 其他国家

**显示**:
```
[请选择国家 ▼]
```

#### 4. 性别筛选
- **字段**: `gender`
- **类型**: 下拉选择
- **选项**:
  - 全部
  - 男
  - 女
  - 未知

**显示**:
```
[选择性别 ▼]
```

#### 5. 客户类型筛选
- **字段**: `customer_type`
- **类型**: 下拉选择
- **选项**:
  - 全部
  - 新增线索-实时
  - 新增线索-补录
  - 新增线索-重复
  - 新增线索-导入重复

**显示**:
```
[客户类型 ▼]
```

### 筛选操作按钮
```
[🔍 搜索]  [🔄 重选]
```

- **搜索**: 应用筛选条件
- **重选**: 清空所有筛选条件，恢复默认状态

---

## 📊 列表字段定义

### 保留的字段

| 序号 | 字段名 | 说明 | 是否保留 |
|-----|--------|------|---------|
| 1 | ☑ | 复选框 | ✅ 保留 |
| 2 | 序号 | 自动编号 | ✅ 保留 |
| 3 | 激活码 | 所属激活码 | ✅ 保留 |
| 4 | 客户信息 | 客户ID和头像 | ✅ 保留 |
| 5 | 用户昵称 | 显示名称 | ✅ 保留 |
| 6 | 手机号 | 绑定手机号 | ✅ 保留 |
| 7 | 所属社交账号 | 所属Line账号 | ✅ 保留 |
| 8 | 备注 | 客户备注 | ✅ 保留 |
| 9 | 客户类型 | 客户分类 | ✅ 保留 |
| 10 | 国家 | 所在国家 | ✅ 保留 |
| 11 | 添加时间 | 首次添加时间 | ✅ 保留 |
| 12 | 更新时间 | 最后更新时间 | ✅ 保留 |
| 13 | 操作 | 详情 | ✅ 保留 |

### 移除的字段
- ❌ 客户标签

### 移除的功能
- ❌ 标签查询（选择标签、重置标签）
- ❌ 共享跟进

---

## 📝 字段详细说明

### 1. 序号
- **字段名**: -
- **类型**: 自动编号
- **说明**: 从1开始的序号

**示例**:
```
1
2
3
```

---

### 2. 激活码
- **字段名**: `activation_code`
- **类型**: `VARCHAR(32)`
- **说明**: 该客户所属的激活码（分组）
- **显示方式**: 文字

**示例**:
```
2nXZMRbA
zsXnJbgU
tqfCRQZx
```

---

### 3. 客户信息
- **字段名**: `customer_id` + `avatar_url`
- **类型**: `VARCHAR(100)` + `VARCHAR(500)`
- **说明**: 客户的Line ID和头像
- **显示方式**: 头像图片 + Line ID

**示例**:
```
[头像]
U2f6b817a2d757a179406da03f5ef9617
```

---

### 4. 用户昵称
- **字段名**: `display_name`
- **类型**: `VARCHAR(100)`
- **说明**: 客户的显示名称或昵称
- **显示方式**: 文字

**示例**:
```
张三
田中結衣
藤本水花
```

---

### 5. 手机号
- **字段名**: `phone_number`
- **类型**: `VARCHAR(20)`
- **说明**: 客户绑定的手机号码
- **显示方式**: 文字或空

**示例**:
```
+886123456789
+81901234567
（空）
```

---

### 6. 所属社交账号
- **字段名**: `line_account_id`
- **类型**: `INTEGER`
- **说明**: 该客户是从哪个Line账号添加的
- **显示方式**: Line账号显示名称或Line ID

**示例**:
```
line1 (@abc123)
千尋 (dk36289)
藤本水花 (@034gytbs)
```

---

### 7. 备注
- **字段名**: `remark`
- **类型**: `TEXT`
- **说明**: 对该客户的备注信息
- **显示方式**: 文字显示 + 编辑功能

**示例**:
```
VIP客户
重点跟进
测试客户
```

**交互**:
- 支持内联编辑
- 点击可快速修改备注

---

### 8. 客户类型
- **字段名**: `customer_type`
- **类型**: `VARCHAR(50)`
- **说明**: 客户的线索类型，表示客户是如何添加到系统的
- **可选值**:
  - `新增线索-实时` - 实时上报的新增线索
  - `新增线索-补录` - 后补录入的新增线索
  - `新增线索-重复` - 重复的线索（实时）
  - `新增线索-导入重复` - 导入时发现重复的线索

**显示方式**: 标签或文字
```
新增线索-实时         (绿色标签)
新增线索-补录         (蓝色标签)
新增线索-重复         (橙色标签)
新增线索-导入重复     (红色标签)
```

---

### 9. 国家
- **字段名**: `country`
- **类型**: `VARCHAR(50)`
- **说明**: 客户所在的国家
- **显示方式**: 国家名称或国旗图标

**示例**:
```
日本 🇯🇵
台湾 🇹🇼
泰国 🇹🇭
```

---

### 10. 添加时间
- **字段名**: `created_at`
- **类型**: `TIMESTAMP`
- **说明**: 客户首次添加到系统的时间
- **显示方式**: 日期时间格式

**示例**:
```
2025-12-21 15:30:22
2025-12-20 18:45:10
```

---

### 11. 更新时间
- **字段名**: `updated_at`
- **类型**: `TIMESTAMP`
- **说明**: 客户信息最后一次更新的时间
- **显示方式**: 日期时间格式

**示例**:
```
2025-12-21 16:20:30
2025-12-21 10:15:45
```

---

### 12. 操作
- **字段名**: -
- **类型**: 按钮
- **说明**: 对该客户的操作

**操作按钮**:
```
[👁️ 详情]
```

**功能说明**:
- **详情**: 查看客户的详细信息（站内页面）

**交互**:
- 点击"详情"按钮，跳转到客户详情页面
- 或在弹窗中显示客户详细信息

---

## 📱 列表页面布局

### 页面结构
```
┌─────────────────────────────────────────────────────────────┐
│  📋 客户列表                                                 │
│  说明：开启了'线索分析'的激活码，或在社交账号上对客户添加了│
│        '客户画像'信息，才会上报客户信息                      │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  平台：                                                       │
│  ☑ 全选  ☑ Line  ☑ Line Business                           │
│                                                               │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  [筛选区域]                                                   │
│  ┌──────────┬────────────┬────────┬────────┬────────┐      │
│  │开始时间～│[激活码▼]   │国家    │性别    │客户类型│      │
│  │截止时间  │[请输入]    │        │        │        │      │
│  └──────────┴────────────┴────────┴────────┴────────┘      │
│                                                               │
│  [🔍 搜索]  [🔄 重选]                                        │
│                                                               │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  [跟进记录]                                                   │
│                                                               │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  [数据表格]                                                   │
│  ┌──┬──┬────┬────┬────┬────┬────┬────┬────┬──┬────┬────┬──┐│
│  │☑│序│激活│客户│昵称│手机│社交│备注│类型│国│添加│更新│操││
│  │  │号│码  │信息│    │号  │账号│    │    │家│时间│时间│作││
│  ├──┼──┼────┼────┼────┼────┼────┼────┼────┼──┼────┼────┼──┤│
│  │  │  │    │    │    │    │    │    │    │  │    │    │  ││
│  │  │  │  （暂无数据）                                     ││
│  │  │  │    │    │    │    │    │    │    │  │    │    │  ││
│  └──┴──┴────┴────┴────┴────┴────┴────┴────┴──┴────┴────┴──┘│
│                                                               │
│  共 0 条     [10条/页 ▼]  [◀] [1] [▶]                       │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

---

## 💾 数据库表结构

### customers 表（客户表）

```sql
CREATE TABLE customers (
    id BIGSERIAL PRIMARY KEY,
    
    -- 关联信息
    group_id INTEGER NOT NULL REFERENCES groups(id) ON DELETE CASCADE,
    activation_code VARCHAR(32) NOT NULL,              -- 所属激活码
    line_account_id INTEGER REFERENCES line_accounts(id), -- 所属Line账号
    
    -- 平台信息
    platform_type VARCHAR(20) NOT NULL,                -- 'line' | 'line_business'
    
    -- 客户基本信息
    customer_id VARCHAR(100) NOT NULL,                 -- Line User ID
    display_name VARCHAR(100),                         -- 显示名称
    avatar_url VARCHAR(500),                           -- 头像URL
    phone_number VARCHAR(20),                          -- 手机号
    
    -- 客户分类信息
    customer_type VARCHAR(50),                         -- 客户类型：'新增线索-实时' | '新增线索-补录' | '新增线索-重复' | '新增线索-导入重复'
    gender VARCHAR(10),                                -- 性别：'male' | 'female' | 'unknown'
    country VARCHAR(50),                               -- 国家
    
    -- 备注
    remark TEXT,                                       -- 备注信息
    
    -- 客户画像（JSON格式存储更多信息）
    profile_data JSONB,                                -- 客户画像数据
    
    -- 时间戳
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,    -- 添加时间
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,    -- 更新时间
    
    -- 索引
    INDEX idx_group_id (group_id),
    INDEX idx_activation_code (activation_code),
    INDEX idx_line_account (line_account_id),
    INDEX idx_platform_type (platform_type),
    INDEX idx_customer_id (customer_id),
    INDEX idx_customer_type (customer_type),
    INDEX idx_country (country),
    INDEX idx_created_at (created_at),
    INDEX idx_updated_at (updated_at)
);

-- 唯一性约束（同一平台下的客户ID唯一）
CREATE UNIQUE INDEX idx_unique_customer 
ON customers(customer_id, platform_type);
```

---

## 📄 客户详情页面

### 页面说明

**触发方式**: 点击列表中的"详情"按钮

**页面类型**: 站内页面（弹窗或新页面）

**页面URL**: `/customer-detail?id={customer_id}`

**页面标题**: 客户详细

### 详情页面字段

#### 1. 客户信息区域

**账号信息**（只读）:
- **字段名**: `line_account_info`
- **显示**: Line账号的头像 + 用户名 + Line ID
- **示例**: 
  ```
  [头像] TK4
  UJks8spa-UUMDU68gqVPhMtCUVMWvP_ldztkunxGbkN1hbSW95TKOJqaz-...
  ```

**所属社交账号**（只读）:
- **字段名**: `owner_account`
- **显示**: 头像 + 显示名称 + Line ID
- **示例**:
  ```
  [头像] 佐藤 美穗
  fv6635
  ```

**客户ID**（只读）:
- **字段名**: `customer_id`
- **显示**: Line User ID
- **示例**: `UHEfXkbysJZQzBbgfhCA23-ojuk`

#### 2. 可编辑字段

**手机号**:
- **字段名**: `phone_number`
- **类型**: 文本输入框
- **占位符**: （空）
- **示例**: `+886123456789`

**昵称备注**:
- **字段名**: `nickname_remark`
- **类型**: 文本输入框
- **字符限制**: 0/20（最多20个字符）
- **占位符**: 请输入昵称备注
- **示例**: `VIP客户`

**性别**:
- **字段名**: `gender`
- **类型**: 下拉选择
- **选项**:
  - 请选择
  - 男
  - 女
  - 未知

**国家**:
- **字段名**: `country`
- **类型**: 下拉选择
- **占位符**: 请选择国家
- **选项**:
  - 请选择国家
  - 日本
  - 台湾
  - 泰国
  - 中国
  - 其他国家

**生日**:
- **字段名**: `birthday`
- **类型**: 日期选择器
- **占位符**: 请选择日期
- **格式**: YYYY-MM-DD

**地址**:
- **字段名**: `address`
- **类型**: 文本输入框
- **占位符**: （空）
- **示例**: `东京都涩谷区xxx`

**标签**:
- **字段名**: `tags`
- **类型**: 标签选择器
- **显示**: [选择] 按钮
- **功能**: 点击选择标签（多选）
- **注意**: 虽然列表中移除了标签，但详情页面保留标签功能用于内部管理

**备注**:
- **字段名**: `remark`
- **类型**: 多行文本输入框
- **占位符**: 请输入备注
- **行数**: 3-5行
- **示例**: 
  ```
  重点客户
  需要定期跟进
  对产品感兴趣
  ```

### 页面布局

```
┌─────────────────────────────────────────────────────────┐
│  客户详细                                    [关闭 ✕]  │
├─────────────────────────────────────────────────────────┤
│                                                           │
│  客户信息：                                               │
│  ┌─────────────────────────────────────────────────┐   │
│  │ 账号信息：[头像] TK4                              │   │
│  │          UJks8spa-UUMDU68gq...                  │   │
│  │                                                  │   │
│  │ 所属社交账号：[头像] 佐藤 美穗 fv6635            │   │
│  │                                                  │   │
│  │ 客户ID：  UHEfXkbysJZQzBbgfhCA23-ojuk           │   │
│  └─────────────────────────────────────────────────┘   │
│                                                           │
│  手机号：     [________________]                         │
│                                                           │
│  昵称备注：   [________________]  0/20                   │
│                                                           │
│  性别：       [请选择 ▼]                                 │
│                                                           │
│  国家：       [请选择国家 ▼]                             │
│                                                           │
│  生日：       [请选择日期 📅]                            │
│                                                           │
│  地址：       [________________]                         │
│                                                           │
│  标签：       [选择]                                     │
│                                                           │
│  备注：       ┌──────────────────────┐                  │
│              │ 请输入备注             │                  │
│              │                        │                  │
│              │                        │                  │
│              └──────────────────────┘                  │
│                                                           │
│               [保存]  [取消]                              │
│                                                           │
└─────────────────────────────────────────────────────────┘
```

### 详情页面操作

**保存按钮**:
- 保存所有可编辑字段的修改
- 验证必填字段
- 更新 `updated_at` 时间戳

**取消按钮**:
- 关闭详情页面
- 不保存修改

**关闭按钮**:
- 右上角 ✕ 按钮
- 关闭详情页面

---

## 🔘 跟进记录按钮

### 按钮位置
筛选区域下方

### 按钮功能
```
[📝 跟进记录]
```

**功能**: 批量添加跟进记录

**触发条件**:
- 勾选至少一个客户
- 按钮才会激活

**交互**:
1. 勾选客户
2. 点击"跟进记录"按钮
3. 弹出添加跟进记录对话框
4. 填写跟进内容
5. 保存后，跟进记录关联到选中的客户

---

## 🔄 客户数据来源

### 数据上报方式

#### 1. 线索分析功能
- 激活码开启"线索分析"功能
- Windows客户端自动上报客户信息
- 系统自动创建或更新客户记录

#### 2. 客户画像手动添加
- 在社交账号上手动添加客户画像信息
- 填写客户的基本信息（昵称、手机号、性别、国家等）
- 保存后上报到服务器

### WebSocket消息格式

**客户信息上报**:
```json
{
  "type": "customer_sync",
  "data": {
    "customer_id": "U2f6b817a2d757a179406da03f5ef9617",
    "display_name": "张三",
    "avatar_url": "https://line.me/avatar/xxx.jpg",
    "phone_number": "+886123456789",
    "gender": "male",
    "country": "Taiwan",
    "customer_type": "新增线索-实时",
    "platform_type": "line",
    "line_account_id": 123,
    "profile_data": {
      "age": 25,
      "interests": ["sports", "music"]
    }
  }
}
```

---

## 📊 统计功能（可选）

### 客户统计
- 总客户数
- 新客户数（本月/本周）
- 各国家客户分布
- 男女比例
- 各类型客户占比

---

## ✅ 已确认需求

- [x] 平台筛选（Line / Line Business）
- [x] 筛选功能（时间、激活码、国家、性别、客户类型）
- [x] 列表字段定义（移除客户标签）
- [x] 操作功能（详情 - 站内客户详情信息）
- [x] 跟进记录按钮
- [x] 数据库表结构
- [x] 客户数据来源说明
- [x] 移除标签查询功能
- [x] 移除共享跟进功能


